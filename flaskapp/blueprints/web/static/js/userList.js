webpackJsonp([1],{319:function(e,t,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var n=r(1),a=s(n),u=r(10),o=r(7);r(17),r(18);var l=r(8),i=r(320),c=s(i),d=r(19),p=s(d),f=r(321),h=s(f),m=r(20),E=(0,m.configureStore)({auth:p.default,userList:h.default}),g=(0,l.layout)({comp:c.default,forAuth:!0});(0,u.render)(a.default.createElement(o.Provider,{store:E},a.default.createElement(g,null)),document.getElementById("root"))},320:function(e,t,r){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),l=r(1),i=function(e){return e&&e.__esModule?e:{default:e}}(l),c=r(7),d=r(23),p=r(29),f=r(8),h=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),o(t,[{key:"friendRequest",value:function(e){return e.preventDefault(),this.props.friendRequest(this.props.user.id)}},{key:"friendRemove",value:function(e){return e.preventDefault(),this.props.friendRemove(this.props.user.id)}},{key:"render",value:function(){var e=this.props.user.online?"success":"active",t=null;return t=null!==this.props.user.selfFriendId&&null!==this.props.user.friendUserId?i.default.createElement("button",{className:"btn btn-default",onClick:this.friendRemove.bind(this)},i.default.createElement("span",{className:"glyphicon glyphicon-minus"}),"  Remove from friends"):null!==this.props.user.selfFriendId?i.default.createElement("button",{className:"btn btn-default",onClick:this.friendRequest.bind(this)},i.default.createElement("span",{className:"glyphicon glyphicon-plus"}),"  Approve friend"):null!==this.props.user.friendUserId?i.default.createElement("button",{disabled:!0,className:"btn btn-default",onClick:this.friendRequest.bind(this)},i.default.createElement("span",{className:"glyphicon glyphicon-plus"}),"  Add to friends"):i.default.createElement("button",{className:"btn btn-default",onClick:this.friendRequest.bind(this)},i.default.createElement("span",{className:"glyphicon glyphicon-plus"}),"  Add to friends"),i.default.createElement("tr",{className:e},i.default.createElement("td",null,i.default.createElement("span",{className:"glyphicon glyphicon-user"})," ",i.default.createElement("span",null,this.props.user.login)),i.default.createElement("td",null,this.props.user.dtActive),i.default.createElement("td",{className:"text-right"},t," ",i.default.createElement("button",{className:"btn btn-default"},i.default.createElement("span",{className:"glyphicon glyphicon-envelope"}),"  Send message")))}}]),t}(i.default.Component),m=function(e){function t(e){s(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={start:r.props.userList.start,users:r.props.userList.users},r}return a(t,e),o(t,[{key:"componentWillMount",value:function(){this.changePage(this.props.userList.start)}},{key:"changePage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.props.dispatch((0,d.graphql)({type:"USER_LIST",start:e,perpage:this.props.userList.perpage}))}},{key:"friendRequest",value:function(e){this.props.dispatch((0,d.graphql)({type:"FRIEND_REQUEST",id:e}))}},{key:"friendRemove",value:function(e){this.props.dispatch((0,d.graphql)({type:"FRIEND_REMOVE",id:e}))}},{key:"getUserItems",value:function(){var e=this,t=(0,p.map)(this.props.userList.users,function(t){return i.default.createElement(h,{user:t,friendRequest:e.friendRequest.bind(e),friendRemove:e.friendRemove.bind(e)})});return i.default.createElement("table",{className:"table table-hover"},i.default.createElement("tbody",null,t))}},{key:"render",value:function(){var e=null;"error"==this.props.userList.status?e={className:"danger",text:this.props.userList.error}:"send"===this.props.userList.status&&(e={className:"info",text:"Loading, please wait"});var t={start:this.props.userList.start,perpage:this.props.userList.perpage,count:this.props.userList.count,items:this.getUserItems(),changePage:this.changePage.bind(this)};return i.default.createElement("div",null,i.default.createElement(f.AlertMessage,{opts:e}),i.default.createElement(f.PaginatorLayout,{param:t}))}}]),t}(i.default.Component),E=function(e){return u({},e)};m=(0,c.connect)(E)(m),t.default=m},321:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},n=r(29),a={userId:window.localParams.userId?parseInt(window.localParams.userId):null,start:window.localParams.start?parseInt(window.localParams.start):0,perpage:window.localParams.perpage?parseInt(window.localParams.perpage):9,users:[],count:0,status:null,error:null},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments[1];console.log("state",e,"action",t);var r=s({},e);switch(t.type){case"USER_LIST_SEND":return r.start=t.start,r.status="send",r;case"USER_LIST_SUCCESS":return r.status="success",r.users=t.data.getUserList.users,r.count=t.data.getUserList.count,r;case"USER_LIST_ERROR":return r.status="error",r.error=t.error,r;case"FRIEND_REQUEST_SEND":return r.status="send",r;case"FRIEND_REQUEST_SUCCESS":return r.status="success",(0,n.forEach)(r.users,function(e){parseInt(e.id)==t.data.friendRequest.friendId&&(e.friendUserId=t.data.friendRequest.userId)}),r;case"FRIEND_REQUEST_ERROR":return r.status="error",r;case"FRIEND_REMOVE_SEND":return r.status="send",r;case"FRIEND_REMOVE_SUCCESS":return r.status="success",(0,n.forEach)(r.users,function(e){console.log("action.data.friendRemove.id",t.data.friendRemove.id),parseInt(e.id)==t.data.friendRemove.friendId&&(e.friendUserId=null)}),r;case"FRIEND_REMOVE_ERROR":return r.status="error",r;default:return e}};t.default=u}},[319]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vdXNlckxpc3QuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy91c2VyTGlzdC5qcyIsIndlYnBhY2s6Ly8vLi9zdGF0aWNfc3JjL3VzZXIvTGlzdENvbXAuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy91c2VyL0xpc3RSZWQuanMiXSwibmFtZXMiOlsid2VicGFja0pzb25wIiwiMzE5IiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfcmVhY3QiLCJfcmVhY3QyIiwiX3JlYWN0RG9tIiwiX3JlYWN0UmVkdXgiLCJfY29tcG9uZW50IiwiX0xpc3RDb21wIiwiX0xpc3RDb21wMiIsIl9Mb2dpblJlZCIsIl9Mb2dpblJlZDIiLCJfTGlzdFJlZCIsIl9MaXN0UmVkMiIsIl9jb25maWd1cmVTdG9yZSIsInN0b3JlIiwiY29uZmlndXJlU3RvcmUiLCJhdXRoIiwidXNlckxpc3QiLCJDb21wIiwibGF5b3V0IiwiY29tcCIsIkxpc3RDb21wIiwiZm9yQXV0aCIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJQcm92aWRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCIzMjAiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJzZWxmIiwiY2FsbCIsIlJlZmVyZW5jZUVycm9yIiwiX2luaGVyaXRzIiwic3ViQ2xhc3MiLCJzdXBlckNsYXNzIiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiY29uc3RydWN0b3IiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJ3cml0YWJsZSIsImNvbmZpZ3VyYWJsZSIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiZGVmaW5lUHJvcGVydHkiLCJfZXh0ZW5kcyIsImFzc2lnbiIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJwcm9wcyIsImRlc2NyaXB0b3IiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJfYWN0aW9uIiwiX2xvZGFzaCIsIlVzZXJJdGVtQ29tcCIsIl9SZWFjdCRDb21wb25lbnQiLCJ0aGlzIiwiZ2V0UHJvdG90eXBlT2YiLCJhcHBseSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImZyaWVuZFJlcXVlc3QiLCJ1c2VyIiwiaWQiLCJmcmllbmRSZW1vdmUiLCJ0ZXh0Q2xhc3MiLCJvbmxpbmUiLCJmcmllbmRCdG4iLCJzZWxmRnJpZW5kSWQiLCJmcmllbmRVc2VySWQiLCJjbGFzc05hbWUiLCJvbkNsaWNrIiwiYmluZCIsImRpc2FibGVkIiwibG9naW4iLCJkdEFjdGl2ZSIsIlJlYWN0IiwiQ29tcG9uZW50IiwiVXNlckxpc3RDb21wIiwiX1JlYWN0JENvbXBvbmVudDIiLCJfdGhpczIiLCJzdGF0ZSIsInN0YXJ0IiwidXNlcnMiLCJjaGFuZ2VQYWdlIiwidW5kZWZpbmVkIiwiZGlzcGF0Y2giLCJncmFwaHFsIiwidHlwZSIsInBlcnBhZ2UiLCJfdGhpczMiLCJpdGVtcyIsIm1hcCIsImFsZXJ0T3B0cyIsInN0YXR1cyIsInRleHQiLCJlcnJvciIsInBhZ2VyUGFyYW0iLCJjb3VudCIsImdldFVzZXJJdGVtcyIsIkFsZXJ0TWVzc2FnZSIsIm9wdHMiLCJQYWdpbmF0b3JMYXlvdXQiLCJwYXJhbSIsIm1hcFN0YXRlVG9Qcm9wcyIsImNvbm5lY3QiLCIzMjEiLCJpbml0U3RhdGUiLCJ1c2VySWQiLCJ3aW5kb3ciLCJsb2NhbFBhcmFtcyIsInBhcnNlSW50IiwiYWN0aW9uIiwiY29uc29sZSIsImxvZyIsImRhdGEiLCJnZXRVc2VyTGlzdCIsImZvckVhY2giLCJ1IiwiZnJpZW5kSWQiXSwibWFwcGluZ3MiOiJB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QixDQUVYLFNBQ0ksTUFBT2xDLElINFduQm5HLEdBQVFLLFFHeFdPZ0IsS0g0V1oiLCJmaWxlIjoidXNlckxpc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ3ZWJwYWNrSnNvbnAoWzFdLHtcblxuLyoqKi8gMzE5OlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuXG52YXIgX3JlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcmVhY3REb20gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTtcblxudmFyIF9yZWFjdFJlZHV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7XG5cbl9fd2VicGFja19yZXF1aXJlX18oMTgpO1xuXG52YXIgX2NvbXBvbmVudCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7XG5cbnZhciBfTGlzdENvbXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyMCk7XG5cbnZhciBfTGlzdENvbXAyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTGlzdENvbXApO1xuXG52YXIgX0xvZ2luUmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7XG5cbnZhciBfTG9naW5SZWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTG9naW5SZWQpO1xuXG52YXIgX0xpc3RSZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyMSk7XG5cbnZhciBfTGlzdFJlZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9MaXN0UmVkKTtcblxudmFyIF9jb25maWd1cmVTdG9yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjApO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG52YXIgc3RvcmUgPSAoMCwgX2NvbmZpZ3VyZVN0b3JlLmNvbmZpZ3VyZVN0b3JlKSh7XG5cdGF1dGg6IF9Mb2dpblJlZDIuZGVmYXVsdCxcblx0dXNlckxpc3Q6IF9MaXN0UmVkMi5kZWZhdWx0XG59KTtcblxudmFyIENvbXAgPSAoMCwgX2NvbXBvbmVudC5sYXlvdXQpKHsgY29tcDogX0xpc3RDb21wMi5kZWZhdWx0LCBmb3JBdXRoOiB0cnVlIH0pO1xuKDAsIF9yZWFjdERvbS5yZW5kZXIpKF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuXHRfcmVhY3RSZWR1eC5Qcm92aWRlcixcblx0eyBzdG9yZTogc3RvcmUgfSxcblx0X3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tcCwgbnVsbClcbiksIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb290JykpO1xuXG4vKioqLyB9KSxcblxuLyoqKi8gMzIwOlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgICB2YWx1ZTogdHJ1ZVxufSk7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbnZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9yZWFjdFJlZHV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTtcblxudmFyIF9hY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTtcblxudmFyIF9sb2Rhc2ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5KTtcblxudmFyIF9jb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbi8vIG9uZSB1c2VyIHJvd1xudmFyIFVzZXJJdGVtQ29tcCA9IGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKFVzZXJJdGVtQ29tcCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBVc2VySXRlbUNvbXAoKSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVc2VySXRlbUNvbXApO1xuXG4gICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoVXNlckl0ZW1Db21wLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoVXNlckl0ZW1Db21wKSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKFVzZXJJdGVtQ29tcCwgW3tcbiAgICAgICAga2V5OiAnZnJpZW5kUmVxdWVzdCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmcmllbmRSZXF1ZXN0KGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmZyaWVuZFJlcXVlc3QodGhpcy5wcm9wcy51c2VyLmlkKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZnJpZW5kUmVtb3ZlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZyaWVuZFJlbW92ZShlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5mcmllbmRSZW1vdmUodGhpcy5wcm9wcy51c2VyLmlkKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAncmVuZGVyJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgICAgIHZhciB0ZXh0Q2xhc3MgPSB0aGlzLnByb3BzLnVzZXIub25saW5lID8gJ3N1Y2Nlc3MnIDogJ2FjdGl2ZSc7XG4gICAgICAgICAgICB2YXIgZnJpZW5kQnRuID0gbnVsbDtcbiAgICAgICAgICAgIC8vIGlmIGJvdGggdXNlcnMgc2VuZGVkIGZyaWVuZCByZXF1ZXN0c1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMudXNlci5zZWxmRnJpZW5kSWQgIT09IG51bGwgJiYgdGhpcy5wcm9wcy51c2VyLmZyaWVuZFVzZXJJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZyaWVuZEJ0biA9IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdidG4gYnRuLWRlZmF1bHQnLCBvbkNsaWNrOiB0aGlzLmZyaWVuZFJlbW92ZS5iaW5kKHRoaXMpIH0sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLW1pbnVzJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgJ1xceEEwIFJlbW92ZSBmcm9tIGZyaWVuZHMnXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIHRoaXMgcm93IHNlbmRlZCByZXF1ZXN0IHRvIGN1cnJlbnQgdXNlclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5wcm9wcy51c2VyLnNlbGZGcmllbmRJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBmcmllbmRCdG4gPSBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdidG4gYnRuLWRlZmF1bHQnLCBvbkNsaWNrOiB0aGlzLmZyaWVuZFJlcXVlc3QuYmluZCh0aGlzKSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ2dseXBoaWNvbiBnbHlwaGljb24tcGx1cycgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAnXFx4QTAgQXBwcm92ZSBmcmllbmQnXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGlmIGN1cnJlbnQgdXNlciBzZW5kZWQgcmVxdWVzdCB0byBjdXJyZW50IHJvd1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMucHJvcHMudXNlci5mcmllbmRVc2VySWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyaWVuZEJ0biA9IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgZGlzYWJsZWQ6IHRydWUsIGNsYXNzTmFtZTogJ2J0biBidG4tZGVmYXVsdCcsIG9uQ2xpY2s6IHRoaXMuZnJpZW5kUmVxdWVzdC5iaW5kKHRoaXMpIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ2dseXBoaWNvbiBnbHlwaGljb24tcGx1cycgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1xceEEwIEFkZCB0byBmcmllbmRzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyaWVuZEJ0biA9IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnYnRuIGJ0bi1kZWZhdWx0Jywgb25DbGljazogdGhpcy5mcmllbmRSZXF1ZXN0LmJpbmQodGhpcykgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi1wbHVzJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXFx4QTAgQWRkIHRvIGZyaWVuZHMnXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAndHInLFxuICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiB0ZXh0Q2xhc3MgfSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ3RkJyxcbiAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ2dseXBoaWNvbiBnbHlwaGljb24tdXNlcicgfSksXG4gICAgICAgICAgICAgICAgICAgICdcXHhBMCcsXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMudXNlci5sb2dpblxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ3RkJyxcbiAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy51c2VyLmR0QWN0aXZlXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ3RkJyxcbiAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICd0ZXh0LXJpZ2h0JyB9LFxuICAgICAgICAgICAgICAgICAgICBmcmllbmRCdG4sXG4gICAgICAgICAgICAgICAgICAgICdcXHhBMCcsXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2J0biBidG4tZGVmYXVsdCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLWVudmVsb3BlJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdcXHhBMCBTZW5kIG1lc3NhZ2UnXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIFVzZXJJdGVtQ29tcDtcbn0oX3JlYWN0Mi5kZWZhdWx0LkNvbXBvbmVudCk7XG5cbi8vIGxpc3Qgb2YgdXNlcnNcblxuXG52YXIgVXNlckxpc3RDb21wID0gZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQyKSB7XG4gICAgX2luaGVyaXRzKFVzZXJMaXN0Q29tcCwgX1JlYWN0JENvbXBvbmVudDIpO1xuXG4gICAgZnVuY3Rpb24gVXNlckxpc3RDb21wKHByb3BzKSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVc2VyTGlzdENvbXApO1xuXG4gICAgICAgIHZhciBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoVXNlckxpc3RDb21wLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoVXNlckxpc3RDb21wKSkuY2FsbCh0aGlzLCBwcm9wcykpO1xuXG4gICAgICAgIF90aGlzMi5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHN0YXJ0OiBfdGhpczIucHJvcHMudXNlckxpc3Quc3RhcnQsXG4gICAgICAgICAgICB1c2VyczogX3RoaXMyLnByb3BzLnVzZXJMaXN0LnVzZXJzXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpczI7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKFVzZXJMaXN0Q29tcCwgW3tcbiAgICAgICAga2V5OiAnY29tcG9uZW50V2lsbE1vdW50JyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxNb3VudCgpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlUGFnZSh0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXJ0KTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnY2hhbmdlUGFnZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFuZ2VQYWdlKCkge1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwO1xuXG4gICAgICAgICAgICB0aGlzLnByb3BzLmRpc3BhdGNoKCgwLCBfYWN0aW9uLmdyYXBocWwpKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnVVNFUl9MSVNUJyxcbiAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgICAgICAgICAgcGVycGFnZTogdGhpcy5wcm9wcy51c2VyTGlzdC5wZXJwYWdlXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2ZyaWVuZFJlcXVlc3QnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZnJpZW5kUmVxdWVzdChpZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaCgoMCwgX2FjdGlvbi5ncmFwaHFsKSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0ZSSUVORF9SRVFVRVNUJyxcbiAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZnJpZW5kUmVtb3ZlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZyaWVuZFJlbW92ZShpZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaCgoMCwgX2FjdGlvbi5ncmFwaHFsKSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0ZSSUVORF9SRU1PVkUnLFxuICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdnZXRVc2VySXRlbXMnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VXNlckl0ZW1zKCkge1xuICAgICAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBpdGVtcyA9ICgwLCBfbG9kYXNoLm1hcCkodGhpcy5wcm9wcy51c2VyTGlzdC51c2VycywgZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoVXNlckl0ZW1Db21wLCB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHVzZXIsXG4gICAgICAgICAgICAgICAgICAgIGZyaWVuZFJlcXVlc3Q6IF90aGlzMy5mcmllbmRSZXF1ZXN0LmJpbmQoX3RoaXMzKSxcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kUmVtb3ZlOiBfdGhpczMuZnJpZW5kUmVtb3ZlLmJpbmQoX3RoaXMzKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAndGFibGUnLFxuICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAndGFibGUgdGFibGUtaG92ZXInIH0sXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICd0Ym9keScsXG4gICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qXG4gICAgICAgICBnZXRVc2VySXRlbXMgKCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBtYXAodGhpcy5wcm9wcy51c2VyTGlzdC51c2VycywgdXNlciA9PiB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZnJpZW5kUmVxdWVzdCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICBzZWxmLnByb3BzLmRpc3BhdGNoKGdyYXBocWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZSSUVORF9SRVFVRVNUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB1c2VyLmlkXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIGxldCB0ZXh0Q2xhc3MgPSB1c2VyLm9ubGluZSA/ICdzdWNjZXNzJyA6ICdhY3RpdmUnO1xuICAgICAgICAgICAgICAgIHJldHVybiA8dHIgY2xhc3NOYW1lPXt0ZXh0Q2xhc3N9PlxuICAgICAgICAgICAgICAgICAgICA8dGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLXVzZXJcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPnt1c2VyLmxvZ2lufTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgPHRkPlxuICAgICAgICAgICAgICAgICAgICAgICAge3VzZXIuZHRBY3RpdmV9XG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9XCJ0ZXh0LXJpZ2h0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImJ0biBidG4tZGVmYXVsdFwiIG9uQ2xpY2s9e2ZyaWVuZFJlcXVlc3R9ID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLXBsdXNcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkIHRvIGZyaWVuZFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1lbnZlbG9wZVwiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kIG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICByZXR1cm4gPHRhYmxlIGNsYXNzTmFtZT1cInRhYmxlIHRhYmxlLWhvdmVyXCI+XG4gICAgICAgICAgICAgICAgPHRib2R5PlxuICAgICAgICAgICAgICAgICAgICB7aXRlbXN9XG4gICAgICAgICAgICAgICAgPC90Ym9keT5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgIH1cbiAgICAgICAgICAqL1xuXG4gICAgfSwge1xuICAgICAgICBrZXk6ICdyZW5kZXInLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAgICAgdmFyIGFsZXJ0T3B0cyA9IG51bGw7XG4gICAgICAgICAgICB2YXIgdXNlcnMgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy51c2VyTGlzdC5zdGF0dXMgPT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZGFuZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5wcm9wcy51c2VyTGlzdC5lcnJvclxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMudXNlckxpc3Quc3RhdHVzID09PSAnc2VuZCcpIHtcbiAgICAgICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2luZm8nLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnTG9hZGluZywgcGxlYXNlIHdhaXQnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHBhZ2VyUGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IHRoaXMucHJvcHMudXNlckxpc3Quc3RhcnQsXG4gICAgICAgICAgICAgICAgcGVycGFnZTogdGhpcy5wcm9wcy51c2VyTGlzdC5wZXJwYWdlLFxuICAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLnByb3BzLnVzZXJMaXN0LmNvdW50LFxuICAgICAgICAgICAgICAgIGl0ZW1zOiB0aGlzLmdldFVzZXJJdGVtcygpLFxuICAgICAgICAgICAgICAgIGNoYW5nZVBhZ2U6IHRoaXMuY2hhbmdlUGFnZS5iaW5kKHRoaXMpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY29tcG9uZW50LkFsZXJ0TWVzc2FnZSwgeyBvcHRzOiBhbGVydE9wdHMgfSksXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NvbXBvbmVudC5QYWdpbmF0b3JMYXlvdXQsIHsgcGFyYW06IHBhZ2VyUGFyYW0gfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XSk7XG5cbiAgICByZXR1cm4gVXNlckxpc3RDb21wO1xufShfcmVhY3QyLmRlZmF1bHQuQ29tcG9uZW50KTtcblxudmFyIG1hcFN0YXRlVG9Qcm9wcyA9IGZ1bmN0aW9uIG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSkge1xuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xufTtcblVzZXJMaXN0Q29tcCA9ICgwLCBfcmVhY3RSZWR1eC5jb25uZWN0KShtYXBTdGF0ZVRvUHJvcHMpKFVzZXJMaXN0Q29tcCk7XG5cbmV4cG9ydHMuZGVmYXVsdCA9IFVzZXJMaXN0Q29tcDtcblxuLyoqKi8gfSksXG5cbi8qKiovIDMyMTpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gICAgdmFsdWU6IHRydWVcbn0pO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG52YXIgX2xvZGFzaCA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpO1xuXG52YXIgaW5pdFN0YXRlID0ge1xuICAgIHVzZXJJZDogd2luZG93LmxvY2FsUGFyYW1zLnVzZXJJZCA/IHBhcnNlSW50KHdpbmRvdy5sb2NhbFBhcmFtcy51c2VySWQpIDogbnVsbCxcbiAgICBzdGFydDogd2luZG93LmxvY2FsUGFyYW1zLnN0YXJ0ID8gcGFyc2VJbnQod2luZG93LmxvY2FsUGFyYW1zLnN0YXJ0KSA6IDAsXG4gICAgcGVycGFnZTogd2luZG93LmxvY2FsUGFyYW1zLnBlcnBhZ2UgPyBwYXJzZUludCh3aW5kb3cubG9jYWxQYXJhbXMucGVycGFnZSkgOiA5LFxuICAgIHVzZXJzOiBbXSxcbiAgICBjb3VudDogMCxcbiAgICBzdGF0dXM6IG51bGwsXG4gICAgZXJyb3I6IG51bGxcbn07XG52YXIgdXNlckxpc3QgPSBmdW5jdGlvbiB1c2VyTGlzdCgpIHtcbiAgICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGluaXRTdGF0ZTtcbiAgICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdO1xuXG4gICAgY29uc29sZS5sb2coJ3N0YXRlJywgc3RhdGUsICdhY3Rpb24nLCBhY3Rpb24pO1xuXG4gICAgdmFyIGRhdGEgPSBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xuICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnVVNFUl9MSVNUX1NFTkQnOlxuICAgICAgICAgICAgZGF0YS5zdGFydCA9IGFjdGlvbi5zdGFydDtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3NlbmQnO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ1VTRVJfTElTVF9TVUNDRVNTJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3MnO1xuICAgICAgICAgICAgZGF0YS51c2VycyA9IGFjdGlvbi5kYXRhLmdldFVzZXJMaXN0LnVzZXJzO1xuICAgICAgICAgICAgZGF0YS5jb3VudCA9IGFjdGlvbi5kYXRhLmdldFVzZXJMaXN0LmNvdW50O1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ1VTRVJfTElTVF9FUlJPUic6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFUVVFU1RfU0VORCc6XG4gICAgICAgICAgICAvLyBkYXRhLnN0YXJ0ID0gYWN0aW9uLnN0YXJ0O1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc2VuZCc7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFUVVFU1RfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzJztcbiAgICAgICAgICAgICgwLCBfbG9kYXNoLmZvckVhY2gpKGRhdGEudXNlcnMsIGZ1bmN0aW9uICh1KSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHUuaWQpID09IGFjdGlvbi5kYXRhLmZyaWVuZFJlcXVlc3QuZnJpZW5kSWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICBzZWxmRnJpZW5kSWQgPSBncmFwaGVuZS5JbnQoKVxuICAgICAgICAgICAgICAgICAgICBmcmllbmRVc2VySWQgPSBncmFwaGVuZS5JbnQoKVxuICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAvLyB1LnNlbGZGcmllbmRJZCA9IGFjdGlvbi5kYXRhLmZyaWVuZFJlcXVlc3QuaWRcbiAgICAgICAgICAgICAgICAgICAgdS5mcmllbmRVc2VySWQgPSBhY3Rpb24uZGF0YS5mcmllbmRSZXF1ZXN0LnVzZXJJZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gZGF0YS51c2VycyA9IGFjdGlvbi5kYXRhLmdldFVzZXJMaXN0LnVzZXJzO1xuICAgICAgICAgICAgLy8gZGF0YS5jb3VudCA9IGFjdGlvbi5kYXRhLmdldFVzZXJMaXN0LmNvdW50O1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRVFVRVNUX0VSUk9SJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ2Vycm9yJztcbiAgICAgICAgICAgIC8vIGRhdGEuZXJyb3IgPSBhY3Rpb24uZXJyb3I7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcblxuICAgICAgICBjYXNlICdGUklFTkRfUkVNT1ZFX1NFTkQnOlxuICAgICAgICAgICAgLy8gZGF0YS5zdGFydCA9IGFjdGlvbi5zdGFydDtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3NlbmQnO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRU1PVkVfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzJztcbiAgICAgICAgICAgICgwLCBfbG9kYXNoLmZvckVhY2gpKGRhdGEudXNlcnMsIGZ1bmN0aW9uICh1KSB7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYWN0aW9uLmRhdGEuZnJpZW5kUmVtb3ZlLmlkJywgYWN0aW9uLmRhdGEuZnJpZW5kUmVtb3ZlLmlkKTtcblxuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCh1LmlkKSA9PSBhY3Rpb24uZGF0YS5mcmllbmRSZW1vdmUuZnJpZW5kSWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICBzZWxmRnJpZW5kSWQgPSBncmFwaGVuZS5JbnQoKVxuICAgICAgICAgICAgICAgICAgICBmcmllbmRVc2VySWQgPSBncmFwaGVuZS5JbnQoKVxuICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICB1LmZyaWVuZFVzZXJJZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFTU9WRV9FUlJPUic6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICAvLyBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG59O1xuXG5leHBvcnRzLmRlZmF1bHQgPSB1c2VyTGlzdDtcblxuLyoqKi8gfSlcblxufSxbMzE5XSk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHVzZXJMaXN0LmpzIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgcmVuZGVyIH0gZnJvbSAncmVhY3QtZG9tJ1xuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICdyZWFjdC1yZWR1eCdcblxuaW1wb3J0ICdib290c3RyYXAvZGlzdC9jc3MvYm9vdHN0cmFwLmNzcyc7XG5pbXBvcnQgJy4vc3R5bGVzL2luZGV4LnNjc3MnXG5cbmltcG9ydCB7bGF5b3V0fSBmcm9tICcuL2hlbHBlcnMvY29tcG9uZW50J1xuaW1wb3J0IExpc3RDb21wIGZyb20gJy4vdXNlci9MaXN0Q29tcCdcblxuaW1wb3J0IGF1dGggZnJvbSAnLi9hdXRoL0xvZ2luUmVkJ1xuaW1wb3J0IHVzZXJMaXN0IGZyb20gJy4vdXNlci9MaXN0UmVkJ1xuXG5pbXBvcnQge2NvbmZpZ3VyZVN0b3JlfSBmcm9tICcuL2hlbHBlcnMvY29uZmlndXJlU3RvcmUnXG5cbmxldCBzdG9yZSA9IGNvbmZpZ3VyZVN0b3JlKHtcblx0YXV0aDogYXV0aCxcblx0dXNlckxpc3Q6IHVzZXJMaXN0LFxufSk7XG5cbmxldCBDb21wID0gbGF5b3V0KHtjb21wOiBMaXN0Q29tcCwgZm9yQXV0aDogdHJ1ZX0pO1xucmVuZGVyKFxuXHQ8UHJvdmlkZXIgc3RvcmU9e3N0b3JlfT5cblx0XHQ8Q29tcCAvPlxuXHQ8L1Byb3ZpZGVyPixcblx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKVxuKVxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3N0YXRpY19zcmMvdXNlckxpc3QuanMiLCJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IGdyYXBocWwgfSBmcm9tICcuLi9oZWxwZXJzL2FjdGlvbic7XG5pbXBvcnQge21hcCwgaXNOdW1iZXJ9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQge0FsZXJ0TWVzc2FnZSwgUGFnaW5hdG9yTGF5b3V0fSBmcm9tICcuLi9oZWxwZXJzL2NvbXBvbmVudCc7XG5cblxuXG5cbi8vIG9uZSB1c2VyIHJvd1xuY2xhc3MgVXNlckl0ZW1Db21wIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBmcmllbmRSZXF1ZXN0IChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuZnJpZW5kUmVxdWVzdCh0aGlzLnByb3BzLnVzZXIuaWQpO1xuICAgIH1cbiAgICBmcmllbmRSZW1vdmUgKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5mcmllbmRSZW1vdmUodGhpcy5wcm9wcy51c2VyLmlkKTtcbiAgICB9XG4gICAgcmVuZGVyICgpIHtcbiAgICAgICAgbGV0IHRleHRDbGFzcyA9IHRoaXMucHJvcHMudXNlci5vbmxpbmUgPyAnc3VjY2VzcycgOiAnYWN0aXZlJztcbiAgICAgICAgbGV0IGZyaWVuZEJ0biA9IG51bGw7XG4gICAgICAgIC8vIGlmIGJvdGggdXNlcnMgc2VuZGVkIGZyaWVuZCByZXF1ZXN0c1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLnByb3BzLnVzZXIuc2VsZkZyaWVuZElkICE9PSBudWxsICYmXG4gICAgICAgICAgICB0aGlzLnByb3BzLnVzZXIuZnJpZW5kVXNlcklkICE9PSBudWxsXG4gICAgICAgICkge1xuICAgICAgICAgICAgZnJpZW5kQnRuID0gPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLWRlZmF1bHRcIiBvbkNsaWNrPXs6OnRoaXMuZnJpZW5kUmVtb3ZlfSA+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1taW51c1wiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICBSZW1vdmUgZnJvbSBmcmllbmRzXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgfVxuICAgICAgICAvLyBpZiB0aGlzIHJvdyBzZW5kZWQgcmVxdWVzdCB0byBjdXJyZW50IHVzZXJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5wcm9wcy51c2VyLnNlbGZGcmllbmRJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZnJpZW5kQnRuID0gPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLWRlZmF1bHRcIiBvbkNsaWNrPXs6OnRoaXMuZnJpZW5kUmVxdWVzdH0gPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tcGx1c1wiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICBBcHByb3ZlIGZyaWVuZFxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgY3VycmVudCB1c2VyIHNlbmRlZCByZXF1ZXN0IHRvIGN1cnJlbnQgcm93XG4gICAgICAgIGVsc2UgaWYgKHRoaXMucHJvcHMudXNlci5mcmllbmRVc2VySWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGZyaWVuZEJ0biA9IDxidXR0b24gZGlzYWJsZWQgY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCIgb25DbGljaz17Ojp0aGlzLmZyaWVuZFJlcXVlc3R9ID5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLXBsdXNcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgQWRkIHRvIGZyaWVuZHNcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnJpZW5kQnRuID0gPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLWRlZmF1bHRcIiBvbkNsaWNrPXs6OnRoaXMuZnJpZW5kUmVxdWVzdH0gPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tcGx1c1wiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICBBZGQgdG8gZnJpZW5kc1xuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gPHRyIGNsYXNzTmFtZT17dGV4dENsYXNzfT5cbiAgICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLXVzZXJcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgPHNwYW4+e3RoaXMucHJvcHMudXNlci5sb2dpbn08L3NwYW4+XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgPHRkPlxuICAgICAgICAgICAgICAgIHt0aGlzLnByb3BzLnVzZXIuZHRBY3RpdmV9XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT1cInRleHQtcmlnaHRcIj5cbiAgICAgICAgICAgICAgICB7ZnJpZW5kQnRufVxuICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tZW52ZWxvcGVcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgICAgICBTZW5kIG1lc3NhZ2VcbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgfVxufVxuXG4vLyBsaXN0IG9mIHVzZXJzXG5jbGFzcyBVc2VyTGlzdENvbXAgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc3RhcnQ6IHRoaXMucHJvcHMudXNlckxpc3Quc3RhcnQsXG4gICAgICAgICAgICB1c2VyczogdGhpcy5wcm9wcy51c2VyTGlzdC51c2VycyxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxNb3VudCAoKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlUGFnZSh0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXJ0KTtcbiAgICB9XG5cbiAgICBjaGFuZ2VQYWdlIChzdGFydCA9IDApIHtcbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdVU0VSX0xJU1QnLFxuICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgcGVycGFnZTogdGhpcy5wcm9wcy51c2VyTGlzdC5wZXJwYWdlLFxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgZnJpZW5kUmVxdWVzdCAoaWQpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdGUklFTkRfUkVRVUVTVCcsXG4gICAgICAgICAgICBpZDogaWRcbiAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGZyaWVuZFJlbW92ZSAoaWQpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdGUklFTkRfUkVNT1ZFJyxcbiAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgZ2V0VXNlckl0ZW1zICgpIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSBtYXAodGhpcy5wcm9wcy51c2VyTGlzdC51c2VycywgdXNlciA9PiB7XG4gICAgICAgICAgICByZXR1cm4gPFVzZXJJdGVtQ29tcFxuICAgICAgICAgICAgICAgIHVzZXI9e3VzZXJ9XG4gICAgICAgICAgICAgICAgZnJpZW5kUmVxdWVzdD17Ojp0aGlzLmZyaWVuZFJlcXVlc3R9XG4gICAgICAgICAgICAgICAgZnJpZW5kUmVtb3ZlPXs6OnRoaXMuZnJpZW5kUmVtb3ZlfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiA8dGFibGUgY2xhc3NOYW1lPVwidGFibGUgdGFibGUtaG92ZXJcIj5cbiAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICB7aXRlbXN9XG4gICAgICAgICAgICA8L3Rib2R5PlxuICAgICAgICA8L3RhYmxlPlxuICAgIH1cblxuICAgIC8qXG5cbiAgICBnZXRVc2VySXRlbXMgKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gbWFwKHRoaXMucHJvcHMudXNlckxpc3QudXNlcnMsIHVzZXIgPT4ge1xuICAgICAgICAgICAgZnVuY3Rpb24gZnJpZW5kUmVxdWVzdCAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdGUklFTkRfUkVRVUVTVCcsXG4gICAgICAgICAgICAgICAgICAgIGlkOiB1c2VyLmlkXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgdGV4dENsYXNzID0gdXNlci5vbmxpbmUgPyAnc3VjY2VzcycgOiAnYWN0aXZlJztcbiAgICAgICAgICAgIHJldHVybiA8dHIgY2xhc3NOYW1lPXt0ZXh0Q2xhc3N9PlxuICAgICAgICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi11c2VyXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4+e3VzZXIubG9naW59PC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgPHRkPlxuICAgICAgICAgICAgICAgICAgICB7dXNlci5kdEFjdGl2ZX1cbiAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9XCJ0ZXh0LXJpZ2h0XCI+XG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCIgb25DbGljaz17ZnJpZW5kUmVxdWVzdH0gPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1wbHVzXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBBZGQgdG8gZnJpZW5kXG4gICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLWRlZmF1bHRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tZW52ZWxvcGVcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmQgbWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgPC90cj5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIDx0YWJsZSBjbGFzc05hbWU9XCJ0YWJsZSB0YWJsZS1ob3ZlclwiPlxuICAgICAgICAgICAgPHRib2R5PlxuICAgICAgICAgICAgICAgIHtpdGVtc31cbiAgICAgICAgICAgIDwvdGJvZHk+XG4gICAgICAgIDwvdGFibGU+XG4gICAgfVxuXG4gICAgICovXG5cblxuICAgIHJlbmRlciAoKSB7XG4gICAgICAgIGxldCBhbGVydE9wdHMgPSBudWxsO1xuICAgICAgICBsZXQgdXNlcnMgPSBudWxsO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXR1cyA9PSAnZXJyb3InKSB7XG4gICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZGFuZ2VyJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnByb3BzLnVzZXJMaXN0LmVycm9yXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy51c2VyTGlzdC5zdGF0dXMgPT09ICdzZW5kJykge1xuICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2luZm8nLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdMb2FkaW5nLCBwbGVhc2Ugd2FpdCcsXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcGFnZXJQYXJhbSA9IHtcbiAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXJ0LFxuICAgICAgICAgICAgcGVycGFnZTogdGhpcy5wcm9wcy51c2VyTGlzdC5wZXJwYWdlLFxuICAgICAgICAgICAgY291bnQ6IHRoaXMucHJvcHMudXNlckxpc3QuY291bnQsXG4gICAgICAgICAgICBpdGVtczogdGhpcy5nZXRVc2VySXRlbXMoKSxcbiAgICAgICAgICAgIGNoYW5nZVBhZ2U6IDo6dGhpcy5jaGFuZ2VQYWdlLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgPEFsZXJ0TWVzc2FnZSBvcHRzPXthbGVydE9wdHN9IC8+XG4gICAgICAgICAgICA8UGFnaW5hdG9yTGF5b3V0IHBhcmFtPXtwYWdlclBhcmFtfSAvPlxuICAgICAgICA8L2Rpdj5cblxuICAgIH1cbn1cbmNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IChzdGF0ZSkgPT4ge1xuICAgIHJldHVybiB7Li4uc3RhdGV9XG59XG5Vc2VyTGlzdENvbXAgPSBjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcykoVXNlckxpc3RDb21wKVxuXG5leHBvcnQgZGVmYXVsdCBVc2VyTGlzdENvbXBcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3N0YXRpY19zcmMvdXNlci9MaXN0Q29tcC5qcyIsImltcG9ydCB7Zm9yRWFjaH0gZnJvbSAnbG9kYXNoJztcbmxldCBpbml0U3RhdGUgPSB7XG4gICAgdXNlcklkOiB3aW5kb3cubG9jYWxQYXJhbXMudXNlcklkID8gcGFyc2VJbnQod2luZG93LmxvY2FsUGFyYW1zLnVzZXJJZCkgOiBudWxsLFxuICAgIHN0YXJ0OiB3aW5kb3cubG9jYWxQYXJhbXMuc3RhcnQgPyBwYXJzZUludCh3aW5kb3cubG9jYWxQYXJhbXMuc3RhcnQpIDogMCxcbiAgICBwZXJwYWdlOiB3aW5kb3cubG9jYWxQYXJhbXMucGVycGFnZSA/IHBhcnNlSW50KHdpbmRvdy5sb2NhbFBhcmFtcy5wZXJwYWdlKSA6IDksXG4gICAgdXNlcnM6IFtdLFxuICAgIGNvdW50OiAwLFxuICAgIHN0YXR1czogbnVsbCxcbiAgICBlcnJvcjogbnVsbCxcbn07XG5jb25zdCB1c2VyTGlzdCA9IChzdGF0ZSA9IGluaXRTdGF0ZSwgYWN0aW9uKSA9PiB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICAgICdzdGF0ZScsc3RhdGUsXG4gICAgICAgICdhY3Rpb24nLGFjdGlvblxuICAgICk7XG5cbiAgICBsZXQgZGF0YSA9IHsuLi5zdGF0ZX07XG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlICdVU0VSX0xJU1RfU0VORCc6XG4gICAgICAgICAgICBkYXRhLnN0YXJ0ID0gYWN0aW9uLnN0YXJ0O1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc2VuZCc7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnVVNFUl9MSVNUX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc3VjY2Vzcyc7XG4gICAgICAgICAgICBkYXRhLnVzZXJzID0gYWN0aW9uLmRhdGEuZ2V0VXNlckxpc3QudXNlcnM7XG4gICAgICAgICAgICBkYXRhLmNvdW50ID0gYWN0aW9uLmRhdGEuZ2V0VXNlckxpc3QuY291bnQ7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnVVNFUl9MSVNUX0VSUk9SJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ2Vycm9yJztcbiAgICAgICAgICAgIGRhdGEuZXJyb3IgPSBhY3Rpb24uZXJyb3I7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcblxuICAgICAgICBjYXNlICdGUklFTkRfUkVRVUVTVF9TRU5EJzpcbiAgICAgICAgICAgIC8vIGRhdGEuc3RhcnQgPSBhY3Rpb24uc3RhcnQ7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzZW5kJztcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdGUklFTkRfUkVRVUVTVF9TVUNDRVNTJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3MnO1xuICAgICAgICAgICAgZm9yRWFjaChkYXRhLnVzZXJzLCB1ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQodS5pZCkgPT0gYWN0aW9uLmRhdGEuZnJpZW5kUmVxdWVzdC5mcmllbmRJZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgIHNlbGZGcmllbmRJZCA9IGdyYXBoZW5lLkludCgpXG4gICAgICAgICAgICAgICAgICAgIGZyaWVuZFVzZXJJZCA9IGdyYXBoZW5lLkludCgpXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIC8vIHUuc2VsZkZyaWVuZElkID0gYWN0aW9uLmRhdGEuZnJpZW5kUmVxdWVzdC5pZFxuICAgICAgICAgICAgICAgICAgICB1LmZyaWVuZFVzZXJJZCA9IGFjdGlvbi5kYXRhLmZyaWVuZFJlcXVlc3QudXNlcklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGRhdGEudXNlcnMgPSBhY3Rpb24uZGF0YS5nZXRVc2VyTGlzdC51c2VycztcbiAgICAgICAgICAgIC8vIGRhdGEuY291bnQgPSBhY3Rpb24uZGF0YS5nZXRVc2VyTGlzdC5jb3VudDtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdGUklFTkRfUkVRVUVTVF9FUlJPUic6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICAvLyBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFTU9WRV9TRU5EJzpcbiAgICAgICAgICAgIC8vIGRhdGEuc3RhcnQgPSBhY3Rpb24uc3RhcnQ7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzZW5kJztcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdGUklFTkRfUkVNT1ZFX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc3VjY2Vzcyc7XG4gICAgICAgICAgICBmb3JFYWNoKGRhdGEudXNlcnMsIHUgPT4ge1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgICAgICdhY3Rpb24uZGF0YS5mcmllbmRSZW1vdmUuaWQnLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb24uZGF0YS5mcmllbmRSZW1vdmUuaWRcbiAgICAgICAgICAgICAgICApO1xuXG5cbiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQodS5pZCkgPT0gYWN0aW9uLmRhdGEuZnJpZW5kUmVtb3ZlLmZyaWVuZElkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgc2VsZkZyaWVuZElkID0gZ3JhcGhlbmUuSW50KClcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kVXNlcklkID0gZ3JhcGhlbmUuSW50KClcbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgdS5mcmllbmRVc2VySWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRU1PVkVfRVJST1InOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnZXJyb3InO1xuICAgICAgICAgICAgLy8gZGF0YS5lcnJvciA9IGFjdGlvbi5lcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gc3RhdGVcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHVzZXJMaXN0XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3RhdGljX3NyYy91c2VyL0xpc3RSZWQuanMiXSwic291cmNlUm9vdCI6IiJ9