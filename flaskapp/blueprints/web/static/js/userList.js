webpackJsonp([1],{319:function(e,t,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var n=r(1),a=s(n),u=r(10),o=r(7);r(17),r(18);var i=r(8),l=r(320),c=s(l),p=r(19),d=s(p),f=r(321),h=s(f),m=r(20),E=(0,m.configureStore)({auth:d.default,userList:h.default}),g=(0,i.layout)({comp:c.default,forAuth:!0});(0,u.render)(a.default.createElement(o.Provider,{store:E},a.default.createElement(g,null)),document.getElementById("root"))},320:function(e,t,r){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),i=r(1),l=function(e){return e&&e.__esModule?e:{default:e}}(i),c=r(7),p=r(23),d=r(30),f=r(8),h=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),o(t,[{key:"friendRequest",value:function(e){return e.preventDefault(),this.props.friendRequest(this.props.user.id)}},{key:"friendRemove",value:function(e){return e.preventDefault(),this.props.friendRemove(this.props.user.id)}},{key:"render",value:function(){var e=this.props.user.online?"success":"active",t=null;return null!==this.props.user.selfFriendId&&null!==this.props.user.friendUserId?t=l.default.createElement("button",{className:"btn btn-default",onClick:this.friendRemove.bind(this)},l.default.createElement("span",{className:"glyphicon glyphicon-minus"}),"  Remove from friends"):null!==this.props.user.selfFriendId?t=l.default.createElement("button",{className:"btn btn-default",onClick:this.friendRequest.bind(this)},l.default.createElement("span",{className:"glyphicon glyphicon-minus"}),"  Approve friend"):null!==this.props.user.friendUserId&&(t=l.default.createElement("button",{disabled:!0,className:"btn btn-default",onClick:this.friendRequest.bind(this)},l.default.createElement("span",{className:"glyphicon glyphicon-minus"}),"  Add to friends")),l.default.createElement("tr",{className:e},l.default.createElement("td",null,l.default.createElement("span",{className:"glyphicon glyphicon-user"})," ",l.default.createElement("span",null,this.props.user.login)),l.default.createElement("td",null,this.props.user.dtActive),l.default.createElement("td",{className:"text-right"},t," ",l.default.createElement("button",{className:"btn btn-default"},l.default.createElement("span",{className:"glyphicon glyphicon-envelope"}),"  Send message")))}}]),t}(l.default.Component),m=function(e){function t(e){s(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={start:r.props.userList.start,users:r.props.userList.users},r}return a(t,e),o(t,[{key:"componentWillMount",value:function(){this.changePage(this.props.userList.start)}},{key:"changePage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.props.dispatch((0,p.graphql)({type:"USER_LIST",start:e,perpage:this.props.userList.perpage}))}},{key:"friendRequest",value:function(e){this.props.dispatch((0,p.graphql)({type:"FRIEND_REQUEST",id:e}))}},{key:"friendRemove",value:function(e){this.props.dispatch((0,p.graphql)({type:"FRIEND_REMOVE",id:e}))}},{key:"getUserItems",value:function(){var e=this,t=(0,d.map)(this.props.userList.users,function(t){return l.default.createElement(h,{user:t,friendRequest:e.friendRequest.bind(e),friendRemove:e.friendRemove.bind(e)})});return l.default.createElement("table",{className:"table table-hover"},l.default.createElement("tbody",null,t))}},{key:"render",value:function(){var e=null;"error"==this.props.userList.status?e={className:"danger",text:this.props.userList.error}:"send"===this.props.userList.status&&(e={className:"info",text:"Loading, please wait"});var t={start:this.props.userList.start,perpage:this.props.userList.perpage,count:this.props.userList.count,items:this.getUserItems(),changePage:this.changePage.bind(this)};return l.default.createElement("div",null,l.default.createElement(f.AlertMessage,{opts:e}),l.default.createElement(f.PaginatorLayout,{param:t}))}}]),t}(l.default.Component),E=function(e){return u({},e)};m=(0,c.connect)(E)(m),t.default=m},321:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},n=r(30),a={userId:window.localParams.userId?parseInt(window.localParams.userId):null,start:window.localParams.start?parseInt(window.localParams.start):0,perpage:window.localParams.perpage?parseInt(window.localParams.perpage):9,users:[],count:0,status:null,error:null},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments[1];console.log("state",e,"action",t);var r=s({},e);switch(t.type){case"USER_LIST_SEND":return r.start=t.start,r.status="send",r;case"USER_LIST_SUCCESS":return r.status="success",r.users=t.data.getUserList.users,r.count=t.data.getUserList.count,r;case"USER_LIST_ERROR":return r.status="error",r.error=t.error,r;case"FRIEND_REQUEST_SEND":return r.status="send",r;case"FRIEND_REQUEST_SUCCESS":return r.status="success",(0,n.forEach)(r.users,function(e){parseInt(e.id)==t.data.friendRequest.friendId&&(e.friendUserId=t.data.friendRequest.userId)}),r;case"FRIEND_REQUEST_ERROR":return r.status="error",r;case"FRIEND_REMOVE_SEND":return r.status="send",r;case"FRIEND_REMOVE_SUCCESS":return r.status="success",(0,n.forEach)(r.users,function(e){console.log("action.data.friendRemove.id",t.data.friendRemove.id),parseInt(e.id)==t.data.friendRemove.friendId&&(e.friendUserId=null)}),r;case"FRIEND_REMOVE_ERROR":return r.status="error",r;default:return e}};t.default=u}},[319]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vdXNlckxpc3QuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy91c2VyTGlzdC5qcyIsIndlYnBhY2s6Ly8vLi9zdGF0aWNfc3JjL3VzZXIvTGlzdENvbXAuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy91c2VyL0xpc3RSZWQuanMiXSwibmFtZXMiOlsid2VicGFja0pzb25wIiwiMzE5IiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfcmVhY3QiLCJfcmVhY3QyIiwiX3JlYWN0RG9tIiwiX3JlYWN0UmVkdXgiLCJfY29tcG9uZW50IiwiX0xpc3RDb21wIiwiX0xpc3RDb21wMiIsIl9Mb2dpblJlZCIsIl9Mb2dpblJlZDIiLCJfTGlzdFJlZCIsIl9MaXN0UmVkMiIsIl9jb25maWd1cmVTdG9yZSIsInN0b3JlIiwiY29uZmlndXJlU3RvcmUiLCJhdXRoIiwidXNlckxpc3QiLCJDb21wIiwibGF5b3V0IiwiY29tcCIsIkxpc3RDb21wIiwiZm9yQXV0aCIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJQcm92aWRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCIzMjAiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJzZWxmIiwiY2FsbCIsIlJlZmVyZW5jZUVycm9yIiwiX2luaGVyaXRzIiwic3ViQ2xhc3MiLCJzdXBlckNsYXNzIiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiY29uc3RydWN0b3IiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJ3cml0YWJsZSIsImNvbmZpZ3VyYWJsZSIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiZGVmaW5lUHJvcGVydHkiLCJfZXh0ZW5kcyIsImFzc2lnbiIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJwcm9wcyIsImRlc2NyaXB0b3IiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJfYWN0aW9uIiwiX2xvZGFzaCIsIlVzZXJJdGVtQ29tcCIsIl9SZWFjdCRDb21wb25lbnQiLCJ0aGlzIiwiZ2V0UHJvdG90eXBlT2YiLCJhcHBseSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImZyaWVuZFJlcXVlc3QiLCJ1c2VyIiwiaWQiLCJmcmllbmRSZW1vdmUiLCJ0ZXh0Q2xhc3MiLCJvbmxpbmUiLCJmcmllbmRCdG4iLCJzZWxmRnJpZW5kSWQiLCJmcmllbmRVc2VySWQiLCJjbGFzc05hbWUiLCJvbkNsaWNrIiwiYmluZCIsImRpc2FibGVkIiwibG9naW4iLCJkdEFjdGl2ZSIsIlJlYWN0IiwiQ29tcG9uZW50IiwiVXNlckxpc3RDb21wIiwiX1JlYWN0JENvbXBvbmVudDIiLCJfdGhpczIiLCJzdGF0ZSIsInN0YXJ0IiwidXNlcnMiLCJjaGFuZ2VQYWdlIiwidW5kZWZpbmVkIiwiZGlzcGF0Y2giLCJncmFwaHFsIiwidHlwZSIsInBlcnBhZ2UiLCJfdGhpczMiLCJpdGVtcyIsIm1hcCIsImFsZXJ0T3B0cyIsInN0YXR1cyIsInRleHQiLCJlcnJvciIsInBhZ2VyUGFyYW0iLCJjb3VudCIsImdldFVzZXJJdGVtcyIsIkFsZXJ0TWVzc2FnZSIsIm9wdHMiLCJQYWdpbmF0b3JMYXlvdXQiLCJwYXJhbSIsIm1hcFN0YXRlVG9Qcm9wcyIsImNvbm5lY3QiLCIzMjEiLCJpbml0U3RhdGUiLCJ1c2VySWQiLCJ3aW5kb3ciLCJsb2NhbFBhcmFtcyIsInBhcnNlSW50IiwiYWN0aW9uIiwiY29uc29sZSIsImxvZyIsImRhdGEiLCJnZXRVc2VyTGlzdCIsImZvckVhY2giLCJ1IiwiZnJpZW5kSWQiXSwibWFwcGluZ3MiOiJB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KFsxXSx7XG5cbi8qKiovIDMxOTpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cblxudmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX3JlYWN0RG9tID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7XG5cbnZhciBfcmVhY3RSZWR1eCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7XG5cbl9fd2VicGFja19yZXF1aXJlX18oMTcpO1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTtcblxudmFyIF9jb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpO1xuXG52YXIgX0xpc3RDb21wID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMjApO1xuXG52YXIgX0xpc3RDb21wMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xpc3RDb21wKTtcblxudmFyIF9Mb2dpblJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpO1xuXG52YXIgX0xvZ2luUmVkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xvZ2luUmVkKTtcblxudmFyIF9MaXN0UmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMjEpO1xuXG52YXIgX0xpc3RSZWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTGlzdFJlZCk7XG5cbnZhciBfY29uZmlndXJlU3RvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxudmFyIHN0b3JlID0gKDAsIF9jb25maWd1cmVTdG9yZS5jb25maWd1cmVTdG9yZSkoe1xuXHRhdXRoOiBfTG9naW5SZWQyLmRlZmF1bHQsXG5cdHVzZXJMaXN0OiBfTGlzdFJlZDIuZGVmYXVsdFxufSk7XG5cbnZhciBDb21wID0gKDAsIF9jb21wb25lbnQubGF5b3V0KSh7IGNvbXA6IF9MaXN0Q29tcDIuZGVmYXVsdCwgZm9yQXV0aDogdHJ1ZSB9KTtcbigwLCBfcmVhY3REb20ucmVuZGVyKShfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcblx0X3JlYWN0UmVkdXguUHJvdmlkZXIsXG5cdHsgc3RvcmU6IHN0b3JlIH0sXG5cdF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbXAsIG51bGwpXG4pLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpKTtcblxuLyoqKi8gfSksXG5cbi8qKiovIDMyMDpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gICAgdmFsdWU6IHRydWVcbn0pO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXG52YXIgX3JlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcmVhY3RSZWR1eCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7XG5cbnZhciBfYWN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7XG5cbnZhciBfbG9kYXNoID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMCk7XG5cbnZhciBfY29tcG9uZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSA/IGNhbGwgOiBzZWxmOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG4vLyBvbmUgdXNlciByb3dcbnZhciBVc2VySXRlbUNvbXAgPSBmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhVc2VySXRlbUNvbXAsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gVXNlckl0ZW1Db21wKCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVXNlckl0ZW1Db21wKTtcblxuICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKFVzZXJJdGVtQ29tcC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFVzZXJJdGVtQ29tcCkpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xuICAgIH1cblxuICAgIF9jcmVhdGVDbGFzcyhVc2VySXRlbUNvbXAsIFt7XG4gICAgICAgIGtleTogJ2ZyaWVuZFJlcXVlc3QnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZnJpZW5kUmVxdWVzdChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5mcmllbmRSZXF1ZXN0KHRoaXMucHJvcHMudXNlci5pZCk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2ZyaWVuZFJlbW92ZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmcmllbmRSZW1vdmUoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuZnJpZW5kUmVtb3ZlKHRoaXMucHJvcHMudXNlci5pZCk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ3JlbmRlcicsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgICAgICB2YXIgdGV4dENsYXNzID0gdGhpcy5wcm9wcy51c2VyLm9ubGluZSA/ICdzdWNjZXNzJyA6ICdhY3RpdmUnO1xuICAgICAgICAgICAgdmFyIGZyaWVuZEJ0biA9IG51bGw7XG4gICAgICAgICAgICAvLyBpZiBib3RoIHVzZXJzIHNlbmRlZCBmcmllbmQgcmVxdWVzdHNcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLnVzZXIuc2VsZkZyaWVuZElkICE9PSBudWxsICYmIHRoaXMucHJvcHMudXNlci5mcmllbmRVc2VySWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBmcmllbmRCdG4gPSBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnYnRuIGJ0bi1kZWZhdWx0Jywgb25DbGljazogdGhpcy5mcmllbmRSZW1vdmUuYmluZCh0aGlzKSB9LFxuICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi1taW51cycgfSksXG4gICAgICAgICAgICAgICAgICAgICdcXHhBMCBSZW1vdmUgZnJvbSBmcmllbmRzJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBpZiB0aGlzIHJvdyBzZW5kZWQgcmVxdWVzdCB0byBjdXJyZW50IHVzZXJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMucHJvcHMudXNlci5zZWxmRnJpZW5kSWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kQnRuID0gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnYnRuIGJ0bi1kZWZhdWx0Jywgb25DbGljazogdGhpcy5mcmllbmRSZXF1ZXN0LmJpbmQodGhpcykgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLW1pbnVzJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdcXHhBMCBBcHByb3ZlIGZyaWVuZCdcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgY3VycmVudCB1c2VyIHNlbmRlZCByZXF1ZXN0IHRvIGN1cnJlbnQgcm93XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5wcm9wcy51c2VyLmZyaWVuZFVzZXJJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJpZW5kQnRuID0gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBkaXNhYmxlZDogdHJ1ZSwgY2xhc3NOYW1lOiAnYnRuIGJ0bi1kZWZhdWx0Jywgb25DbGljazogdGhpcy5mcmllbmRSZXF1ZXN0LmJpbmQodGhpcykgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi1taW51cycgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1xceEEwIEFkZCB0byBmcmllbmRzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ3RyJyxcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogdGV4dENsYXNzIH0sXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICd0ZCcsXG4gICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLXVzZXInIH0pLFxuICAgICAgICAgICAgICAgICAgICAnXFx4QTAnLFxuICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLnVzZXIubG9naW5cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICd0ZCcsXG4gICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMudXNlci5kdEFjdGl2ZVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICd0ZCcsXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAndGV4dC1yaWdodCcgfSxcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kQnRuLFxuICAgICAgICAgICAgICAgICAgICAnXFx4QTAnLFxuICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdidG4gYnRuLWRlZmF1bHQnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi1lbnZlbG9wZScgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAnXFx4QTAgU2VuZCBtZXNzYWdlJ1xuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1dKTtcblxuICAgIHJldHVybiBVc2VySXRlbUNvbXA7XG59KF9yZWFjdDIuZGVmYXVsdC5Db21wb25lbnQpO1xuXG4vLyBsaXN0IG9mIHVzZXJzXG5cblxudmFyIFVzZXJMaXN0Q29tcCA9IGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50Mikge1xuICAgIF9pbmhlcml0cyhVc2VyTGlzdENvbXAsIF9SZWFjdCRDb21wb25lbnQyKTtcblxuICAgIGZ1bmN0aW9uIFVzZXJMaXN0Q29tcChwcm9wcykge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVXNlckxpc3RDb21wKTtcblxuICAgICAgICB2YXIgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKFVzZXJMaXN0Q29tcC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFVzZXJMaXN0Q29tcCkpLmNhbGwodGhpcywgcHJvcHMpKTtcblxuICAgICAgICBfdGhpczIuc3RhdGUgPSB7XG4gICAgICAgICAgICBzdGFydDogX3RoaXMyLnByb3BzLnVzZXJMaXN0LnN0YXJ0LFxuICAgICAgICAgICAgdXNlcnM6IF90aGlzMi5wcm9wcy51c2VyTGlzdC51c2Vyc1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXMyO1xuICAgIH1cblxuICAgIF9jcmVhdGVDbGFzcyhVc2VyTGlzdENvbXAsIFt7XG4gICAgICAgIGtleTogJ2NvbXBvbmVudFdpbGxNb3VudCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZVBhZ2UodGhpcy5wcm9wcy51c2VyTGlzdC5zdGFydCk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2NoYW5nZVBhZ2UnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2hhbmdlUGFnZSgpIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDtcblxuICAgICAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaCgoMCwgX2FjdGlvbi5ncmFwaHFsKSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1VTRVJfTElTVCcsXG4gICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgICAgIHBlcnBhZ2U6IHRoaXMucHJvcHMudXNlckxpc3QucGVycGFnZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdmcmllbmRSZXF1ZXN0JyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZyaWVuZFJlcXVlc3QoaWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goKDAsIF9hY3Rpb24uZ3JhcGhxbCkoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdGUklFTkRfUkVRVUVTVCcsXG4gICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2ZyaWVuZFJlbW92ZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmcmllbmRSZW1vdmUoaWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goKDAsIF9hY3Rpb24uZ3JhcGhxbCkoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdGUklFTkRfUkVNT1ZFJyxcbiAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZ2V0VXNlckl0ZW1zJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFVzZXJJdGVtcygpIHtcbiAgICAgICAgICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSAoMCwgX2xvZGFzaC5tYXApKHRoaXMucHJvcHMudXNlckxpc3QudXNlcnMsIGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFVzZXJJdGVtQ29tcCwge1xuICAgICAgICAgICAgICAgICAgICB1c2VyOiB1c2VyLFxuICAgICAgICAgICAgICAgICAgICBmcmllbmRSZXF1ZXN0OiBfdGhpczMuZnJpZW5kUmVxdWVzdC5iaW5kKF90aGlzMyksXG4gICAgICAgICAgICAgICAgICAgIGZyaWVuZFJlbW92ZTogX3RoaXMzLmZyaWVuZFJlbW92ZS5iaW5kKF90aGlzMylcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ3RhYmxlJyxcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3RhYmxlIHRhYmxlLWhvdmVyJyB9LFxuICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAndGJvZHknLFxuICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICBpdGVtc1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvKlxuICAgICAgICAgZ2V0VXNlckl0ZW1zICgpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gbWFwKHRoaXMucHJvcHMudXNlckxpc3QudXNlcnMsIHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGZyaWVuZFJlcXVlc3QgKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdGUklFTkRfUkVRVUVTVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdXNlci5pZFxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICBsZXQgdGV4dENsYXNzID0gdXNlci5vbmxpbmUgPyAnc3VjY2VzcycgOiAnYWN0aXZlJztcbiAgICAgICAgICAgICAgICByZXR1cm4gPHRyIGNsYXNzTmFtZT17dGV4dENsYXNzfT5cbiAgICAgICAgICAgICAgICAgICAgPHRkPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi11c2VyXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57dXNlci5sb2dpbn08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHt1c2VyLmR0QWN0aXZlfVxuICAgICAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPVwidGV4dC1yaWdodFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLWRlZmF1bHRcIiBvbkNsaWNrPXtmcmllbmRSZXF1ZXN0fSA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1wbHVzXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZCB0byBmcmllbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImJ0biBidG4tZGVmYXVsdFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tZW52ZWxvcGVcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZCBtZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgcmV0dXJuIDx0YWJsZSBjbGFzc05hbWU9XCJ0YWJsZSB0YWJsZS1ob3ZlclwiPlxuICAgICAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAge2l0ZW1zfVxuICAgICAgICAgICAgICAgIDwvdGJvZHk+XG4gICAgICAgICAgICA8L3RhYmxlPlxuICAgICAgICB9XG4gICAgICAgICAgKi9cblxuICAgIH0sIHtcbiAgICAgICAga2V5OiAncmVuZGVyJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgICAgIHZhciBhbGVydE9wdHMgPSBudWxsO1xuICAgICAgICAgICAgdmFyIHVzZXJzID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMudXNlckxpc3Quc3RhdHVzID09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMucHJvcHMudXNlckxpc3QuZXJyb3JcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXR1cyA9PT0gJ3NlbmQnKSB7XG4gICAgICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdpbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0xvYWRpbmcsIHBsZWFzZSB3YWl0J1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYWdlclBhcmFtID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXJ0LFxuICAgICAgICAgICAgICAgIHBlcnBhZ2U6IHRoaXMucHJvcHMudXNlckxpc3QucGVycGFnZSxcbiAgICAgICAgICAgICAgICBjb3VudDogdGhpcy5wcm9wcy51c2VyTGlzdC5jb3VudCxcbiAgICAgICAgICAgICAgICBpdGVtczogdGhpcy5nZXRVc2VySXRlbXMoKSxcbiAgICAgICAgICAgICAgICBjaGFuZ2VQYWdlOiB0aGlzLmNoYW5nZVBhZ2UuYmluZCh0aGlzKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NvbXBvbmVudC5BbGVydE1lc3NhZ2UsIHsgb3B0czogYWxlcnRPcHRzIH0pLFxuICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jb21wb25lbnQuUGFnaW5hdG9yTGF5b3V0LCB7IHBhcmFtOiBwYWdlclBhcmFtIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIFVzZXJMaXN0Q29tcDtcbn0oX3JlYWN0Mi5kZWZhdWx0LkNvbXBvbmVudCk7XG5cbnZhciBtYXBTdGF0ZVRvUHJvcHMgPSBmdW5jdGlvbiBtYXBTdGF0ZVRvUHJvcHMoc3RhdGUpIHtcbiAgICByZXR1cm4gX2V4dGVuZHMoe30sIHN0YXRlKTtcbn07XG5Vc2VyTGlzdENvbXAgPSAoMCwgX3JlYWN0UmVkdXguY29ubmVjdCkobWFwU3RhdGVUb1Byb3BzKShVc2VyTGlzdENvbXApO1xuXG5leHBvcnRzLmRlZmF1bHQgPSBVc2VyTGlzdENvbXA7XG5cbi8qKiovIH0pLFxuXG4vKioqLyAzMjE6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICAgIHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxudmFyIF9sb2Rhc2ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKTtcblxudmFyIGluaXRTdGF0ZSA9IHtcbiAgICB1c2VySWQ6IHdpbmRvdy5sb2NhbFBhcmFtcy51c2VySWQgPyBwYXJzZUludCh3aW5kb3cubG9jYWxQYXJhbXMudXNlcklkKSA6IG51bGwsXG4gICAgc3RhcnQ6IHdpbmRvdy5sb2NhbFBhcmFtcy5zdGFydCA/IHBhcnNlSW50KHdpbmRvdy5sb2NhbFBhcmFtcy5zdGFydCkgOiAwLFxuICAgIHBlcnBhZ2U6IHdpbmRvdy5sb2NhbFBhcmFtcy5wZXJwYWdlID8gcGFyc2VJbnQod2luZG93LmxvY2FsUGFyYW1zLnBlcnBhZ2UpIDogOSxcbiAgICB1c2VyczogW10sXG4gICAgY291bnQ6IDAsXG4gICAgc3RhdHVzOiBudWxsLFxuICAgIGVycm9yOiBudWxsXG59O1xudmFyIHVzZXJMaXN0ID0gZnVuY3Rpb24gdXNlckxpc3QoKSB7XG4gICAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBpbml0U3RhdGU7XG4gICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTtcblxuICAgIGNvbnNvbGUubG9nKCdzdGF0ZScsIHN0YXRlLCAnYWN0aW9uJywgYWN0aW9uKTtcblxuICAgIHZhciBkYXRhID0gX2V4dGVuZHMoe30sIHN0YXRlKTtcbiAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgJ1VTRVJfTElTVF9TRU5EJzpcbiAgICAgICAgICAgIGRhdGEuc3RhcnQgPSBhY3Rpb24uc3RhcnQ7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzZW5kJztcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdVU0VSX0xJU1RfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzJztcbiAgICAgICAgICAgIGRhdGEudXNlcnMgPSBhY3Rpb24uZGF0YS5nZXRVc2VyTGlzdC51c2VycztcbiAgICAgICAgICAgIGRhdGEuY291bnQgPSBhY3Rpb24uZGF0YS5nZXRVc2VyTGlzdC5jb3VudDtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdVU0VSX0xJU1RfRVJST1InOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnZXJyb3InO1xuICAgICAgICAgICAgZGF0YS5lcnJvciA9IGFjdGlvbi5lcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRVFVRVNUX1NFTkQnOlxuICAgICAgICAgICAgLy8gZGF0YS5zdGFydCA9IGFjdGlvbi5zdGFydDtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3NlbmQnO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRVFVRVNUX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc3VjY2Vzcyc7XG4gICAgICAgICAgICAoMCwgX2xvZGFzaC5mb3JFYWNoKShkYXRhLnVzZXJzLCBmdW5jdGlvbiAodSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCh1LmlkKSA9PSBhY3Rpb24uZGF0YS5mcmllbmRSZXF1ZXN0LmZyaWVuZElkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgc2VsZkZyaWVuZElkID0gZ3JhcGhlbmUuSW50KClcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kVXNlcklkID0gZ3JhcGhlbmUuSW50KClcbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgLy8gdS5zZWxmRnJpZW5kSWQgPSBhY3Rpb24uZGF0YS5mcmllbmRSZXF1ZXN0LmlkXG4gICAgICAgICAgICAgICAgICAgIHUuZnJpZW5kVXNlcklkID0gYWN0aW9uLmRhdGEuZnJpZW5kUmVxdWVzdC51c2VySWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGRhdGEudXNlcnMgPSBhY3Rpb24uZGF0YS5nZXRVc2VyTGlzdC51c2VycztcbiAgICAgICAgICAgIC8vIGRhdGEuY291bnQgPSBhY3Rpb24uZGF0YS5nZXRVc2VyTGlzdC5jb3VudDtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdGUklFTkRfUkVRVUVTVF9FUlJPUic6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICAvLyBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFTU9WRV9TRU5EJzpcbiAgICAgICAgICAgIC8vIGRhdGEuc3RhcnQgPSBhY3Rpb24uc3RhcnQ7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzZW5kJztcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdGUklFTkRfUkVNT1ZFX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc3VjY2Vzcyc7XG4gICAgICAgICAgICAoMCwgX2xvZGFzaC5mb3JFYWNoKShkYXRhLnVzZXJzLCBmdW5jdGlvbiAodSkge1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FjdGlvbi5kYXRhLmZyaWVuZFJlbW92ZS5pZCcsIGFjdGlvbi5kYXRhLmZyaWVuZFJlbW92ZS5pZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQodS5pZCkgPT0gYWN0aW9uLmRhdGEuZnJpZW5kUmVtb3ZlLmZyaWVuZElkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgc2VsZkZyaWVuZElkID0gZ3JhcGhlbmUuSW50KClcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kVXNlcklkID0gZ3JhcGhlbmUuSW50KClcbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgdS5mcmllbmRVc2VySWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRU1PVkVfRVJST1InOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnZXJyb3InO1xuICAgICAgICAgICAgLy8gZGF0YS5lcnJvciA9IGFjdGlvbi5lcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxufTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gdXNlckxpc3Q7XG5cbi8qKiovIH0pXG5cbn0sWzMxOV0pO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB1c2VyTGlzdC5qcyIsImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IHJlbmRlciB9IGZyb20gJ3JlYWN0LWRvbSdcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSAncmVhY3QtcmVkdXgnXG5cbmltcG9ydCAnYm9vdHN0cmFwL2Rpc3QvY3NzL2Jvb3RzdHJhcC5jc3MnO1xuaW1wb3J0ICcuL3N0eWxlcy9pbmRleC5zY3NzJ1xuXG5pbXBvcnQge2xheW91dH0gZnJvbSAnLi9oZWxwZXJzL2NvbXBvbmVudCdcbmltcG9ydCBMaXN0Q29tcCBmcm9tICcuL3VzZXIvTGlzdENvbXAnXG5cbmltcG9ydCBhdXRoIGZyb20gJy4vYXV0aC9Mb2dpblJlZCdcbmltcG9ydCB1c2VyTGlzdCBmcm9tICcuL3VzZXIvTGlzdFJlZCdcblxuaW1wb3J0IHtjb25maWd1cmVTdG9yZX0gZnJvbSAnLi9oZWxwZXJzL2NvbmZpZ3VyZVN0b3JlJ1xuXG5sZXQgc3RvcmUgPSBjb25maWd1cmVTdG9yZSh7XG5cdGF1dGg6IGF1dGgsXG5cdHVzZXJMaXN0OiB1c2VyTGlzdCxcbn0pO1xuXG5sZXQgQ29tcCA9IGxheW91dCh7Y29tcDogTGlzdENvbXAsIGZvckF1dGg6IHRydWV9KTtcbnJlbmRlcihcblx0PFByb3ZpZGVyIHN0b3JlPXtzdG9yZX0+XG5cdFx0PENvbXAgLz5cblx0PC9Qcm92aWRlcj4sXG5cdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb290JylcbilcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zdGF0aWNfc3JjL3VzZXJMaXN0LmpzIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyBncmFwaHFsIH0gZnJvbSAnLi4vaGVscGVycy9hY3Rpb24nO1xuaW1wb3J0IHttYXAsIGlzTnVtYmVyfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtBbGVydE1lc3NhZ2UsIFBhZ2luYXRvckxheW91dH0gZnJvbSAnLi4vaGVscGVycy9jb21wb25lbnQnO1xuXG5cblxuXG4vLyBvbmUgdXNlciByb3dcbmNsYXNzIFVzZXJJdGVtQ29tcCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgZnJpZW5kUmVxdWVzdCAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmZyaWVuZFJlcXVlc3QodGhpcy5wcm9wcy51c2VyLmlkKTtcbiAgICB9XG4gICAgZnJpZW5kUmVtb3ZlIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuZnJpZW5kUmVtb3ZlKHRoaXMucHJvcHMudXNlci5pZCk7XG4gICAgfVxuICAgIHJlbmRlciAoKSB7XG4gICAgICAgIGxldCB0ZXh0Q2xhc3MgPSB0aGlzLnByb3BzLnVzZXIub25saW5lID8gJ3N1Y2Nlc3MnIDogJ2FjdGl2ZSc7XG4gICAgICAgIGxldCBmcmllbmRCdG4gPSBudWxsO1xuICAgICAgICAvLyBpZiBib3RoIHVzZXJzIHNlbmRlZCBmcmllbmQgcmVxdWVzdHNcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5wcm9wcy51c2VyLnNlbGZGcmllbmRJZCAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgdGhpcy5wcm9wcy51c2VyLmZyaWVuZFVzZXJJZCAhPT0gbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICAgIGZyaWVuZEJ0biA9IDxidXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCIgb25DbGljaz17Ojp0aGlzLmZyaWVuZFJlbW92ZX0gPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tbWludXNcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgUmVtb3ZlIGZyb20gZnJpZW5kc1xuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgdGhpcyByb3cgc2VuZGVkIHJlcXVlc3QgdG8gY3VycmVudCB1c2VyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMucHJvcHMudXNlci5zZWxmRnJpZW5kSWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGZyaWVuZEJ0biA9IDxidXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCIgb25DbGljaz17Ojp0aGlzLmZyaWVuZFJlcXVlc3R9ID5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLW1pbnVzXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgIEFwcHJvdmUgZnJpZW5kXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBjdXJyZW50IHVzZXIgc2VuZGVkIHJlcXVlc3QgdG8gY3VycmVudCByb3dcbiAgICAgICAgZWxzZSBpZiAodGhpcy5wcm9wcy51c2VyLmZyaWVuZFVzZXJJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZnJpZW5kQnRuID0gPGJ1dHRvbiBkaXNhYmxlZCBjbGFzc05hbWU9XCJidG4gYnRuLWRlZmF1bHRcIiBvbkNsaWNrPXs6OnRoaXMuZnJpZW5kUmVxdWVzdH0gPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tbWludXNcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgQWRkIHRvIGZyaWVuZHNcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDx0ciBjbGFzc05hbWU9e3RleHRDbGFzc30+XG4gICAgICAgICAgICA8dGQ+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi11c2VyXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgIDxzcGFuPnt0aGlzLnByb3BzLnVzZXIubG9naW59PC9zcGFuPlxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgICAgICB7dGhpcy5wcm9wcy51c2VyLmR0QWN0aXZlfVxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9XCJ0ZXh0LXJpZ2h0XCI+XG4gICAgICAgICAgICAgICAge2ZyaWVuZEJ0bn1cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImJ0biBidG4tZGVmYXVsdFwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLWVudmVsb3BlXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgU2VuZCBtZXNzYWdlXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICA8L3RyPlxuICAgIH1cbn1cblxuLy8gbGlzdCBvZiB1c2Vyc1xuY2xhc3MgVXNlckxpc3RDb21wIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnByb3BzLnVzZXJMaXN0LnN0YXJ0LFxuICAgICAgICAgICAgdXNlcnM6IHRoaXMucHJvcHMudXNlckxpc3QudXNlcnMsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsTW91bnQgKCkge1xuICAgICAgICB0aGlzLmNoYW5nZVBhZ2UodGhpcy5wcm9wcy51c2VyTGlzdC5zdGFydCk7XG4gICAgfVxuXG4gICAgY2hhbmdlUGFnZSAoc3RhcnQgPSAwKSB7XG4gICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICB0eXBlOiAnVVNFUl9MSVNUJyxcbiAgICAgICAgICAgIHN0YXJ0OiBzdGFydCxcbiAgICAgICAgICAgIHBlcnBhZ2U6IHRoaXMucHJvcHMudXNlckxpc3QucGVycGFnZSxcbiAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGZyaWVuZFJlcXVlc3QgKGlkKSB7XG4gICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICB0eXBlOiAnRlJJRU5EX1JFUVVFU1QnLFxuICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBmcmllbmRSZW1vdmUgKGlkKSB7XG4gICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICB0eXBlOiAnRlJJRU5EX1JFTU9WRScsXG4gICAgICAgICAgICBpZDogaWRcbiAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGdldFVzZXJJdGVtcyAoKSB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gbWFwKHRoaXMucHJvcHMudXNlckxpc3QudXNlcnMsIHVzZXIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIDxVc2VySXRlbUNvbXBcbiAgICAgICAgICAgICAgICB1c2VyPXt1c2VyfVxuICAgICAgICAgICAgICAgIGZyaWVuZFJlcXVlc3Q9ezo6dGhpcy5mcmllbmRSZXF1ZXN0fVxuICAgICAgICAgICAgICAgIGZyaWVuZFJlbW92ZT17Ojp0aGlzLmZyaWVuZFJlbW92ZX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gPHRhYmxlIGNsYXNzTmFtZT1cInRhYmxlIHRhYmxlLWhvdmVyXCI+XG4gICAgICAgICAgICA8dGJvZHk+XG4gICAgICAgICAgICAgICAge2l0ZW1zfVxuICAgICAgICAgICAgPC90Ym9keT5cbiAgICAgICAgPC90YWJsZT5cbiAgICB9XG5cbiAgICAvKlxuXG4gICAgZ2V0VXNlckl0ZW1zICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBjb25zdCBpdGVtcyA9IG1hcCh0aGlzLnByb3BzLnVzZXJMaXN0LnVzZXJzLCB1c2VyID0+IHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGZyaWVuZFJlcXVlc3QgKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnByb3BzLmRpc3BhdGNoKGdyYXBocWwoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnRlJJRU5EX1JFUVVFU1QnLFxuICAgICAgICAgICAgICAgICAgICBpZDogdXNlci5pZFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHRleHRDbGFzcyA9IHVzZXIub25saW5lID8gJ3N1Y2Nlc3MnIDogJ2FjdGl2ZSc7XG4gICAgICAgICAgICByZXR1cm4gPHRyIGNsYXNzTmFtZT17dGV4dENsYXNzfT5cbiAgICAgICAgICAgICAgICA8dGQ+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tdXNlclwiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuPnt1c2VyLmxvZ2lufTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgICAgICAgICAge3VzZXIuZHRBY3RpdmV9XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPVwidGV4dC1yaWdodFwiPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImJ0biBidG4tZGVmYXVsdFwiIG9uQ2xpY2s9e2ZyaWVuZFJlcXVlc3R9ID5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tcGx1c1wiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgICAgICAgICAgQWRkIHRvIGZyaWVuZFxuICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1kZWZhdWx0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLWVudmVsb3BlXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBTZW5kIG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgIDwvdHI+XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiA8dGFibGUgY2xhc3NOYW1lPVwidGFibGUgdGFibGUtaG92ZXJcIj5cbiAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICB7aXRlbXN9XG4gICAgICAgICAgICA8L3Rib2R5PlxuICAgICAgICA8L3RhYmxlPlxuICAgIH1cblxuICAgICAqL1xuXG5cbiAgICByZW5kZXIgKCkge1xuICAgICAgICBsZXQgYWxlcnRPcHRzID0gbnVsbDtcbiAgICAgICAgbGV0IHVzZXJzID0gbnVsbDtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy51c2VyTGlzdC5zdGF0dXMgPT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5wcm9wcy51c2VyTGlzdC5lcnJvclxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMudXNlckxpc3Quc3RhdHVzID09PSAnc2VuZCcpIHtcbiAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdpbmZvJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnTG9hZGluZywgcGxlYXNlIHdhaXQnLFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBhZ2VyUGFyYW0gPSB7XG4gICAgICAgICAgICBzdGFydDogdGhpcy5wcm9wcy51c2VyTGlzdC5zdGFydCxcbiAgICAgICAgICAgIHBlcnBhZ2U6IHRoaXMucHJvcHMudXNlckxpc3QucGVycGFnZSxcbiAgICAgICAgICAgIGNvdW50OiB0aGlzLnByb3BzLnVzZXJMaXN0LmNvdW50LFxuICAgICAgICAgICAgaXRlbXM6IHRoaXMuZ2V0VXNlckl0ZW1zKCksXG4gICAgICAgICAgICBjaGFuZ2VQYWdlOiA6OnRoaXMuY2hhbmdlUGFnZSxcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIDxBbGVydE1lc3NhZ2Ugb3B0cz17YWxlcnRPcHRzfSAvPlxuICAgICAgICAgICAgPFBhZ2luYXRvckxheW91dCBwYXJhbT17cGFnZXJQYXJhbX0gLz5cbiAgICAgICAgPC9kaXY+XG5cbiAgICB9XG59XG5jb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSAoc3RhdGUpID0+IHtcbiAgICByZXR1cm4gey4uLnN0YXRlfVxufVxuVXNlckxpc3RDb21wID0gY29ubmVjdChtYXBTdGF0ZVRvUHJvcHMpKFVzZXJMaXN0Q29tcClcblxuZXhwb3J0IGRlZmF1bHQgVXNlckxpc3RDb21wXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zdGF0aWNfc3JjL3VzZXIvTGlzdENvbXAuanMiLCJpbXBvcnQge2ZvckVhY2h9IGZyb20gJ2xvZGFzaCc7XG5sZXQgaW5pdFN0YXRlID0ge1xuICAgIHVzZXJJZDogd2luZG93LmxvY2FsUGFyYW1zLnVzZXJJZCA/IHBhcnNlSW50KHdpbmRvdy5sb2NhbFBhcmFtcy51c2VySWQpIDogbnVsbCxcbiAgICBzdGFydDogd2luZG93LmxvY2FsUGFyYW1zLnN0YXJ0ID8gcGFyc2VJbnQod2luZG93LmxvY2FsUGFyYW1zLnN0YXJ0KSA6IDAsXG4gICAgcGVycGFnZTogd2luZG93LmxvY2FsUGFyYW1zLnBlcnBhZ2UgPyBwYXJzZUludCh3aW5kb3cubG9jYWxQYXJhbXMucGVycGFnZSkgOiA5LFxuICAgIHVzZXJzOiBbXSxcbiAgICBjb3VudDogMCxcbiAgICBzdGF0dXM6IG51bGwsXG4gICAgZXJyb3I6IG51bGwsXG59O1xuY29uc3QgdXNlckxpc3QgPSAoc3RhdGUgPSBpbml0U3RhdGUsIGFjdGlvbikgPT4ge1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAnc3RhdGUnLHN0YXRlLFxuICAgICAgICAnYWN0aW9uJyxhY3Rpb25cbiAgICApO1xuXG4gICAgbGV0IGRhdGEgPSB7Li4uc3RhdGV9O1xuICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnVVNFUl9MSVNUX1NFTkQnOlxuICAgICAgICAgICAgZGF0YS5zdGFydCA9IGFjdGlvbi5zdGFydDtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3NlbmQnO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ1VTRVJfTElTVF9TVUNDRVNTJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3MnO1xuICAgICAgICAgICAgZGF0YS51c2VycyA9IGFjdGlvbi5kYXRhLmdldFVzZXJMaXN0LnVzZXJzO1xuICAgICAgICAgICAgZGF0YS5jb3VudCA9IGFjdGlvbi5kYXRhLmdldFVzZXJMaXN0LmNvdW50O1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ1VTRVJfTElTVF9FUlJPUic6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFUVVFU1RfU0VORCc6XG4gICAgICAgICAgICAvLyBkYXRhLnN0YXJ0ID0gYWN0aW9uLnN0YXJ0O1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc2VuZCc7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFUVVFU1RfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzJztcbiAgICAgICAgICAgIGZvckVhY2goZGF0YS51c2VycywgdSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHUuaWQpID09IGFjdGlvbi5kYXRhLmZyaWVuZFJlcXVlc3QuZnJpZW5kSWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICBzZWxmRnJpZW5kSWQgPSBncmFwaGVuZS5JbnQoKVxuICAgICAgICAgICAgICAgICAgICBmcmllbmRVc2VySWQgPSBncmFwaGVuZS5JbnQoKVxuICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAvLyB1LnNlbGZGcmllbmRJZCA9IGFjdGlvbi5kYXRhLmZyaWVuZFJlcXVlc3QuaWRcbiAgICAgICAgICAgICAgICAgICAgdS5mcmllbmRVc2VySWQgPSBhY3Rpb24uZGF0YS5mcmllbmRSZXF1ZXN0LnVzZXJJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBkYXRhLnVzZXJzID0gYWN0aW9uLmRhdGEuZ2V0VXNlckxpc3QudXNlcnM7XG4gICAgICAgICAgICAvLyBkYXRhLmNvdW50ID0gYWN0aW9uLmRhdGEuZ2V0VXNlckxpc3QuY291bnQ7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFUVVFU1RfRVJST1InOlxuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnZXJyb3InO1xuICAgICAgICAgICAgLy8gZGF0YS5lcnJvciA9IGFjdGlvbi5lcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgICAgIGNhc2UgJ0ZSSUVORF9SRU1PVkVfU0VORCc6XG4gICAgICAgICAgICAvLyBkYXRhLnN0YXJ0ID0gYWN0aW9uLnN0YXJ0O1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc2VuZCc7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnRlJJRU5EX1JFTU9WRV9TVUNDRVNTJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3MnO1xuICAgICAgICAgICAgZm9yRWFjaChkYXRhLnVzZXJzLCB1ID0+IHtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgICAgICAnYWN0aW9uLmRhdGEuZnJpZW5kUmVtb3ZlLmlkJyxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLmRhdGEuZnJpZW5kUmVtb3ZlLmlkXG4gICAgICAgICAgICAgICAgKTtcblxuXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHUuaWQpID09IGFjdGlvbi5kYXRhLmZyaWVuZFJlbW92ZS5mcmllbmRJZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgIHNlbGZGcmllbmRJZCA9IGdyYXBoZW5lLkludCgpXG4gICAgICAgICAgICAgICAgICAgIGZyaWVuZFVzZXJJZCA9IGdyYXBoZW5lLkludCgpXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHUuZnJpZW5kVXNlcklkID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdGUklFTkRfUkVNT1ZFX0VSUk9SJzpcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ2Vycm9yJztcbiAgICAgICAgICAgIC8vIGRhdGEuZXJyb3IgPSBhY3Rpb24uZXJyb3I7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB1c2VyTGlzdFxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3N0YXRpY19zcmMvdXNlci9MaXN0UmVkLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==