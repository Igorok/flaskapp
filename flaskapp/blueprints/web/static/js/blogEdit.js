webpackJsonp([6],{146:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},s=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),u=a(5),c=r(u),d=a(9),f=a(39),p=a(12),g=a(47),h=a(410),b=r(h),m=a(411),E=r(m),y=a(412),v=function(t){function e(t){i(this,e);var a=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a.state=n({},t.blogEdit),a.state.editorState=g.EditorState.createEmpty(),a}return o(e,t),s(e,[{key:"componentWillMount",value:function(){-1!==this.state.id&&this.props.dispatch((0,f.graphql)({type:"BLOG_GET",id:this.state.id}))}},{key:"componentWillReceiveProps",value:function(t){if("success_get"==t.blogEdit.status){var e=(0,E.default)(t.blogEdit.text),a=g.ContentState.createFromBlockArray(e.contentBlocks,e.entityMap);this.setState({title:t.blogEdit.title,text:t.blogEdit.text,public:t.blogEdit.public,date:t.blogEdit.date,editorState:g.EditorState.createWithContent(a)})}}},{key:"fieldChange",value:function(t){var e={},a="public"==t.target.id?t.target.checked:t.target.value;e[t.target.id]=a,this.setState(e)}},{key:"onEditorStateChange",value:function(t){this.setState({editorState:t})}},{key:"formSubmit",value:function(t){t.preventDefault();var e=(0,b.default)((0,g.convertToRaw)(this.state.editorState.getCurrentContent()));if(e&&e.length>512)return this.props.dispatch({type:"BLOG_EDIT_ERROR",error:"Text is too long!"});this.props.dispatch((0,f.graphql)({type:"BLOG_EDIT",id:this.state.id,title:this.state.title,text:(0,b.default)((0,g.convertToRaw)(this.state.editorState.getCurrentContent())),public:this.state.public}))}},{key:"render",value:function(){var t=this,e=null;return"error"===this.props.blogEdit.status?e={className:"danger",text:this.props.blogEdit.error||"Error, wrong blog data"}:"send"===this.props.blogEdit.status?e={className:"info",text:"Loading, please wait"}:"success_edit"===this.props.blogEdit.status&&(e={className:"success",text:"Blog saved successfully"},setTimeout(function(){window.location="/blog-edit/"+t.props.blogEdit.id},1e3)),c.default.createElement("div",null,c.default.createElement("form",{onSubmit:this.formSubmit.bind(this)},c.default.createElement("div",{className:"form-group"},c.default.createElement("label",{htmlFor:"title"},"Title"),c.default.createElement("input",{required:!0,type:"text",className:"form-control",id:"title",placeholder:"Title",onChange:this.fieldChange.bind(this),value:this.state.title})),c.default.createElement("div",{className:"form-group"},c.default.createElement("label",{htmlFor:"text"},"Text"),c.default.createElement(y.Editor,{editorState:this.state.editorState,editorClassName:"form-control",onEditorStateChange:this.onEditorStateChange.bind(this),toolbar:{options:["inline","list","fontSize","fontFamily","textAlign","link","history","colorPicker"]}})),c.default.createElement("div",{className:"checkbox"},c.default.createElement("label",null,c.default.createElement("input",{type:"checkbox",id:"public",onChange:this.fieldChange.bind(this),checked:!!this.state.public})," Public")),c.default.createElement(p.AlertMessage,{opts:e}),c.default.createElement("hr",null),c.default.createElement("div",null,c.default.createElement("button",{type:"submit",className:"btn btn-primary"},c.default.createElement("span",{className:"glyphicon glyphicon-floppy-disk"}),"Â  Save")),c.default.createElement("br",null)))}}]),e}(c.default.Component),_=function(t){return n({},t)};v=(0,d.connect)(_)(v),e.default=v},326:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=a(5),l=r(i),o=a(15),n=a(9);a(25),a(145),a(26);var s=a(12),u=a(146),c=r(u),d=a(27),f=r(d),p=a(413),g=r(p),h=a(28),b=(0,h.configureStore)({auth:f.default,blogEdit:g.default}),m=(0,s.layout)({comp:c.default,forAuth:!0});(0,o.render)(l.default.createElement(n.Provider,{store:b},l.default.createElement(m,null)),document.getElementById("root"))},413:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},i=window.localParams.blogId||"-1",l={id:parseInt(i),user_id:0,user_name:"",title:"",text:"",date:"",public:!1,status:null},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,e=arguments[1],a=null;switch(e.type){case"BLOG_GET_SEND":return r({status:"send"},t);case"BLOG_GET_SUCCESS":return a=r({},t),a.status="success_get",a.id=e.data.getBlog.id,a.user_id=e.data.getBlog.userId,a.user_name=e.data.getBlog.userName,a.text=e.data.getBlog.text,a.title=e.data.getBlog.title,a.date=e.data.getBlog.date,a.public=!!e.data.getBlog.public,a;case"BLOG_GET_ERROR":return r({status:"error",error:e.error},t);case"BLOG_EDIT_SEND":return a=r({},t),a.status="send",a.id=e.id,a.text=e.text,a.title=e.title,a.public=e.public,a;case"BLOG_EDIT_SUCCESS":return a=r({},t),a.status="success_edit",a.id=e.data.editBlog.id,a.text=e.data.editBlog.text,a.title=e.data.editBlog.title,a.public=e.data.editBlog.public,a;case"BLOG_EDIT_ERROR":return a=r({},t),a.status="error",a.error=e.error,a;default:return t}};e.default=o}},[326]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYmxvZ0VkaXQuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy9ibG9nL0VkaXRDb21wLmpzIiwid2VicGFjazovLy8uL3N0YXRpY19zcmMvYmxvZ0VkaXQuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy9ibG9nL0VkaXRSZWQuanMiXSwibmFtZXMiOlsid2VicGFja0pzb25wIiwiMTQ2IiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJzZWxmIiwiY2FsbCIsIlJlZmVyZW5jZUVycm9yIiwiX2luaGVyaXRzIiwic3ViQ2xhc3MiLCJzdXBlckNsYXNzIiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiY29uc3RydWN0b3IiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJ3cml0YWJsZSIsImNvbmZpZ3VyYWJsZSIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiZGVmaW5lUHJvcGVydHkiLCJfZXh0ZW5kcyIsImFzc2lnbiIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJwcm9wcyIsImRlc2NyaXB0b3IiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJfcmVhY3QiLCJfcmVhY3QyIiwiX3JlYWN0UmVkdXgiLCJfYWN0aW9uIiwiX2NvbXBvbmVudCIsIl9kcmFmdEpzIiwiX2RyYWZ0anNUb0h0bWwiLCJfZHJhZnRqc1RvSHRtbDIiLCJfaHRtbFRvRHJhZnRqcyIsIl9odG1sVG9EcmFmdGpzMiIsIl9yZWFjdERyYWZ0V3lzaXd5ZyIsIkVkaXRDb21wIiwiX1JlYWN0JENvbXBvbmVudCIsInRoaXMiLCJfdGhpcyIsImdldFByb3RvdHlwZU9mIiwic3RhdGUiLCJibG9nRWRpdCIsImVkaXRvclN0YXRlIiwiRWRpdG9yU3RhdGUiLCJjcmVhdGVFbXB0eSIsImlkIiwiZGlzcGF0Y2giLCJncmFwaHFsIiwidHlwZSIsIm5leHRQcm9wcyIsInN0YXR1cyIsImJsb2Nrc0Zyb21IVE1MIiwidGV4dCIsImNvbnRlbnQiLCJDb250ZW50U3RhdGUiLCJjcmVhdGVGcm9tQmxvY2tBcnJheSIsImNvbnRlbnRCbG9ja3MiLCJlbnRpdHlNYXAiLCJzZXRTdGF0ZSIsInRpdGxlIiwicHVibGljIiwiZGF0ZSIsImNyZWF0ZVdpdGhDb250ZW50IiwiZSIsInN0YXRlT2JqIiwidmFsIiwiY2hlY2tlZCIsInByZXZlbnREZWZhdWx0IiwiY29udmVydFRvUmF3IiwiZ2V0Q3VycmVudENvbnRlbnQiLCJlcnJvciIsIl90aGlzMiIsImFsZXJ0T3B0cyIsImNsYXNzTmFtZSIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJvblN1Ym1pdCIsImZvcm1TdWJtaXQiLCJiaW5kIiwiaHRtbEZvciIsInJlcXVpcmVkIiwicGxhY2Vob2xkZXIiLCJvbkNoYW5nZSIsImZpZWxkQ2hhbmdlIiwiRWRpdG9yIiwiZWRpdG9yQ2xhc3NOYW1lIiwib25FZGl0b3JTdGF0ZUNoYW5nZSIsInRvb2xiYXIiLCJvcHRpb25zIiwiQWxlcnRNZXNzYWdlIiwib3B0cyIsIlJlYWN0IiwiQ29tcG9uZW50IiwibWFwU3RhdGVUb1Byb3BzIiwiY29ubmVjdCIsIjMyNiIsIl9yZWFjdERvbSIsIl9FZGl0Q29tcCIsIl9FZGl0Q29tcDIiLCJfTG9naW5SZWQiLCJfTG9naW5SZWQyIiwiX0VkaXRSZWQiLCJfRWRpdFJlZDIiLCJfY29uZmlndXJlU3RvcmUiLCJzdG9yZSIsImNvbmZpZ3VyZVN0b3JlIiwiYXV0aCIsIkNvbXAiLCJsYXlvdXQiLCJjb21wIiwiZm9yQXV0aCIsInJlbmRlciIsIlByb3ZpZGVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIjQxMyIsImJsb2dJZCIsImxvY2FsUGFyYW1zIiwiaW5pdFN0YXRlIiwicGFyc2VJbnQiLCJ1c2VyX2lkIiwidXNlcl9uYW1lIiwidW5kZWZpbmVkIiwiYWN0aW9uIiwiZGF0YSIsImdldEJsb2ciLCJ1c2VySWQiLCJ1c2VyTmFtZSIsImVkaXRCbG9nIl0sIm1hcHBpbmdzIjoiQUFBQUEsY0FBYyxJQUVSQyxJQUNBLFNBQVVDLEVBQVFDLEVBQVNDLEdBRWpDLFlBaUNBLFNBQVNDLEdBQXVCQyxHQUFPLE1BQU9BLElBQU9BLEVBQUlDLFdBQWFELEdBQVFFLFFBQVNGLEdBRXZGLFFBQVNHLEdBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJQUFnQixLQUFNLElBQUlDLFdBQVUscUNBRWhILFFBQVNDLEdBQTJCQyxFQUFNQyxHQUFRLElBQUtELEVBQVEsS0FBTSxJQUFJRSxnQkFBZSw0REFBZ0UsUUFBT0QsR0FBeUIsZ0JBQVRBLElBQXFDLGtCQUFUQSxHQUE4QkQsRUFBUEMsRUFFbE8sUUFBU0UsR0FBVUMsRUFBVUMsR0FBYyxHQUEwQixrQkFBZkEsSUFBNEMsT0FBZkEsRUFBdUIsS0FBTSxJQUFJUCxXQUFVLGlFQUFvRU8sR0FBZUQsR0FBU0UsVUFBWUMsT0FBT0MsT0FBT0gsR0FBY0EsRUFBV0MsV0FBYUcsYUFBZUMsTUFBT04sRUFBVU8sWUFBWSxFQUFPQyxVQUFVLEVBQU1DLGNBQWMsS0FBZVIsSUFBWUUsT0FBT08sZUFBaUJQLE9BQU9PLGVBQWVWLEVBQVVDLEdBQWNELEVBQVNXLFVBQVlWLEdBcENqZUUsT0FBT1MsZUFBZTNCLEVBQVMsY0FDM0JxQixPQUFPLEdBR1gsSUFBSU8sR0FBV1YsT0FBT1csUUFBVSxTQUFVQyxHQUFVLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJQyxVQUFVQyxPQUFRRixJQUFLLENBQUUsR0FBSUcsR0FBU0YsVUFBVUQsRUFBSSxLQUFL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a0UsQ0FDWCxLQUFLLGtCQUlELE1BSEFBLFFBQVd0RixHQUNYc0YsRUFBSzVFLE9BQVMsUUFDZDRFLEVBQUt4RCxNQUFRdUQsRUFBT3ZELE1BQ2J3RCxDQUdYLFNBQ0ksTUFBT3RGLElIK1NuQjNELEdBQVFLLFFHM1NPdUQsS0grU1oiLCJmaWxlIjoiYmxvZ0VkaXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ3ZWJwYWNrSnNvbnAoWzZdLHtcblxuLyoqKi8gMTQ2OlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgICB2YWx1ZTogdHJ1ZVxufSk7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbnZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9yZWFjdFJlZHV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTtcblxudmFyIF9hY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM5KTtcblxudmFyIF9jb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTtcblxudmFyIF9kcmFmdEpzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Nyk7XG5cbnZhciBfZHJhZnRqc1RvSHRtbCA9IF9fd2VicGFja19yZXF1aXJlX18oNDEwKTtcblxudmFyIF9kcmFmdGpzVG9IdG1sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RyYWZ0anNUb0h0bWwpO1xuXG52YXIgX2h0bWxUb0RyYWZ0anMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxMSk7XG5cbnZhciBfaHRtbFRvRHJhZnRqczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9odG1sVG9EcmFmdGpzKTtcblxudmFyIF9yZWFjdERyYWZ0V3lzaXd5ZyA9IF9fd2VicGFja19yZXF1aXJlX18oNDEyKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSA/IGNhbGwgOiBzZWxmOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgRWRpdENvbXAgPSBmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhFZGl0Q29tcCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBFZGl0Q29tcChwcm9wcykge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRWRpdENvbXApO1xuXG4gICAgICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChFZGl0Q29tcC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKEVkaXRDb21wKSkuY2FsbCh0aGlzLCBwcm9wcykpO1xuXG4gICAgICAgIF90aGlzLnN0YXRlID0gX2V4dGVuZHMoe30sIHByb3BzLmJsb2dFZGl0KTtcbiAgICAgICAgX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGUgPSBfZHJhZnRKcy5FZGl0b3JTdGF0ZS5jcmVhdGVFbXB0eSgpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKEVkaXRDb21wLCBbe1xuICAgICAgICBrZXk6ICdjb21wb25lbnRXaWxsTW91bnQnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaWQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnByb3BzLmRpc3BhdGNoKCgwLCBfYWN0aW9uLmdyYXBocWwpKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnQkxPR19HRVQnLFxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLnN0YXRlLmlkXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgICAgICAgIGlmIChuZXh0UHJvcHMuYmxvZ0VkaXQuc3RhdHVzID09ICdzdWNjZXNzX2dldCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmxvY2tzRnJvbUhUTUwgPSAoMCwgX2h0bWxUb0RyYWZ0anMyLmRlZmF1bHQpKG5leHRQcm9wcy5ibG9nRWRpdC50ZXh0KTtcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IF9kcmFmdEpzLkNvbnRlbnRTdGF0ZS5jcmVhdGVGcm9tQmxvY2tBcnJheShibG9ja3NGcm9tSFRNTC5jb250ZW50QmxvY2tzLCBibG9ja3NGcm9tSFRNTC5lbnRpdHlNYXApO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBuZXh0UHJvcHMuYmxvZ0VkaXQudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IG5leHRQcm9wcy5ibG9nRWRpdC50ZXh0LFxuICAgICAgICAgICAgICAgICAgICBwdWJsaWM6IG5leHRQcm9wcy5ibG9nRWRpdC5wdWJsaWMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGU6IG5leHRQcm9wcy5ibG9nRWRpdC5kYXRlLFxuICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogX2RyYWZ0SnMuRWRpdG9yU3RhdGUuY3JlYXRlV2l0aENvbnRlbnQoY29udGVudClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZmllbGRDaGFuZ2UnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZmllbGRDaGFuZ2UoZSkge1xuICAgICAgICAgICAgdmFyIHN0YXRlT2JqID0ge307XG4gICAgICAgICAgICB2YXIgdmFsID0gZS50YXJnZXQuaWQgPT0gJ3B1YmxpYycgPyBlLnRhcmdldC5jaGVja2VkIDogZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICBzdGF0ZU9ialtlLnRhcmdldC5pZF0gPSB2YWw7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlT2JqKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnb25FZGl0b3JTdGF0ZUNoYW5nZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkVkaXRvclN0YXRlQ2hhbmdlKGVkaXRvclN0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogZWRpdG9yU3RhdGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdmb3JtU3VibWl0JyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1TdWJtaXQoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIHRleHQgPSAoMCwgX2RyYWZ0anNUb0h0bWwyLmRlZmF1bHQpKCgwLCBfZHJhZnRKcy5jb252ZXJ0VG9SYXcpKHRoaXMuc3RhdGUuZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSkpO1xuXG4gICAgICAgICAgICBpZiAodGV4dCAmJiB0ZXh0Lmxlbmd0aCA+IDUxMikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0JMT0dfRURJVF9FUlJPUicsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiAnVGV4dCBpcyB0b28gbG9uZyEnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goKDAsIF9hY3Rpb24uZ3JhcGhxbCkoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdCTE9HX0VESVQnLFxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLnN0YXRlLmlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnN0YXRlLnRpdGxlLFxuICAgICAgICAgICAgICAgIHRleHQ6ICgwLCBfZHJhZnRqc1RvSHRtbDIuZGVmYXVsdCkoKDAsIF9kcmFmdEpzLmNvbnZlcnRUb1JhdykodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKSksXG4gICAgICAgICAgICAgICAgcHVibGljOiB0aGlzLnN0YXRlLnB1YmxpY1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdyZW5kZXInLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBhbGVydE9wdHMgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5ibG9nRWRpdC5zdGF0dXMgPT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMucHJvcHMuYmxvZ0VkaXQuZXJyb3IgfHwgJ0Vycm9yLCB3cm9uZyBibG9nIGRhdGEnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5ibG9nRWRpdC5zdGF0dXMgPT09ICdzZW5kJykge1xuICAgICAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnaW5mbycsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdMb2FkaW5nLCBwbGVhc2Ugd2FpdCdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ3N1Y2Nlc3NfZWRpdCcpIHtcbiAgICAgICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQmxvZyBzYXZlZCBzdWNjZXNzZnVsbHknXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9ibG9nLWVkaXQvJyArIF90aGlzMi5wcm9wcy5ibG9nRWRpdC5pZDtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdmb3JtJyxcbiAgICAgICAgICAgICAgICAgICAgeyBvblN1Ym1pdDogdGhpcy5mb3JtU3VibWl0LmJpbmQodGhpcykgfSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnZm9ybS1ncm91cCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBodG1sRm9yOiAndGl0bGUnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RpdGxlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZm9ybS1jb250cm9sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3RpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ1RpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5maWVsZENoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnRpdGxlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdmb3JtLWdyb3VwJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGh0bWxGb3I6ICd0ZXh0JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUZXh0J1xuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdERyYWZ0V3lzaXd5Zy5FZGl0b3IsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JDbGFzc05hbWU6ICdmb3JtLWNvbnRyb2wnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2U6IHRoaXMub25FZGl0b3JTdGF0ZUNoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogWydpbmxpbmUnLCAnbGlzdCcsICdmb250U2l6ZScsICdmb250RmFtaWx5JywgJ3RleHRBbGlnbicsICdsaW5rJywgJ2hpc3RvcnknLCAnY29sb3JQaWNrZXInXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2NoZWNrYm94JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdwdWJsaWMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5maWVsZENoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkOiAhIXRoaXMuc3RhdGUucHVibGljXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyBQdWJsaWMnXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jb21wb25lbnQuQWxlcnRNZXNzYWdlLCB7IG9wdHM6IGFsZXJ0T3B0cyB9KSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ2hyJywgbnVsbCksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAnc3VibWl0JywgY2xhc3NOYW1lOiAnYnRuIGJ0bi1wcmltYXJ5JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLWZsb3BweS1kaXNrJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXFx4QTAgU2F2ZSdcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ2JyJywgbnVsbClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIEVkaXRDb21wO1xufShfcmVhY3QyLmRlZmF1bHQuQ29tcG9uZW50KTtcblxudmFyIG1hcFN0YXRlVG9Qcm9wcyA9IGZ1bmN0aW9uIG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSkge1xuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xufTtcbkVkaXRDb21wID0gKDAsIF9yZWFjdFJlZHV4LmNvbm5lY3QpKG1hcFN0YXRlVG9Qcm9wcykoRWRpdENvbXApO1xuZXhwb3J0cy5kZWZhdWx0ID0gRWRpdENvbXA7XG5cbi8qKiovIH0pLFxuXG4vKioqLyAzMjY6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5cbnZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9yZWFjdERvbSA9IF9fd2VicGFja19yZXF1aXJlX18oMTUpO1xuXG52YXIgX3JlYWN0UmVkdXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpO1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXygxNDUpO1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDI2KTtcblxudmFyIF9jb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTtcblxudmFyIF9FZGl0Q29tcCA9IF9fd2VicGFja19yZXF1aXJlX18oMTQ2KTtcblxudmFyIF9FZGl0Q29tcDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9FZGl0Q29tcCk7XG5cbnZhciBfTG9naW5SZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTtcblxudmFyIF9Mb2dpblJlZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Mb2dpblJlZCk7XG5cbnZhciBfRWRpdFJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oNDEzKTtcblxudmFyIF9FZGl0UmVkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0VkaXRSZWQpO1xuXG52YXIgX2NvbmZpZ3VyZVN0b3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOCk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbnZhciBzdG9yZSA9ICgwLCBfY29uZmlndXJlU3RvcmUuY29uZmlndXJlU3RvcmUpKHtcblx0YXV0aDogX0xvZ2luUmVkMi5kZWZhdWx0LFxuXHRibG9nRWRpdDogX0VkaXRSZWQyLmRlZmF1bHRcbn0pO1xuXG52YXIgQ29tcCA9ICgwLCBfY29tcG9uZW50LmxheW91dCkoeyBjb21wOiBfRWRpdENvbXAyLmRlZmF1bHQsIGZvckF1dGg6IHRydWUgfSk7XG4oMCwgX3JlYWN0RG9tLnJlbmRlcikoX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG5cdF9yZWFjdFJlZHV4LlByb3ZpZGVyLFxuXHR7IHN0b3JlOiBzdG9yZSB9LFxuXHRfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChDb21wLCBudWxsKVxuKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKSk7XG5cbi8qKiovIH0pLFxuXG4vKioqLyA0MTM6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICAgIHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxudmFyIGJsb2dJZCA9IHdpbmRvdy5sb2NhbFBhcmFtcy5ibG9nSWQgfHwgJy0xJztcbnZhciBpbml0U3RhdGUgPSB7XG4gICAgaWQ6IHBhcnNlSW50KGJsb2dJZCksXG4gICAgdXNlcl9pZDogMCxcbiAgICB1c2VyX25hbWU6ICcnLFxuICAgIHRpdGxlOiAnJyxcbiAgICB0ZXh0OiAnJyxcbiAgICBkYXRlOiAnJyxcbiAgICBwdWJsaWM6IGZhbHNlLFxuICAgIHN0YXR1czogbnVsbFxufTtcblxudmFyIGJsb2dFZGl0ID0gZnVuY3Rpb24gYmxvZ0VkaXQoKSB7XG4gICAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBpbml0U3RhdGU7XG4gICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTtcblxuICAgIHZhciBkYXRhID0gbnVsbDtcblxuICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnQkxPR19HRVRfU0VORCc6XG4gICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe1xuICAgICAgICAgICAgICAgIHN0YXR1czogJ3NlbmQnXG4gICAgICAgICAgICB9LCBzdGF0ZSk7XG4gICAgICAgIGNhc2UgJ0JMT0dfR0VUX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YSA9IF9leHRlbmRzKHt9LCBzdGF0ZSk7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzX2dldCc7XG4gICAgICAgICAgICBkYXRhLmlkID0gYWN0aW9uLmRhdGEuZ2V0QmxvZy5pZDtcbiAgICAgICAgICAgIGRhdGEudXNlcl9pZCA9IGFjdGlvbi5kYXRhLmdldEJsb2cudXNlcklkO1xuICAgICAgICAgICAgZGF0YS51c2VyX25hbWUgPSBhY3Rpb24uZGF0YS5nZXRCbG9nLnVzZXJOYW1lO1xuICAgICAgICAgICAgZGF0YS50ZXh0ID0gYWN0aW9uLmRhdGEuZ2V0QmxvZy50ZXh0O1xuICAgICAgICAgICAgZGF0YS50aXRsZSA9IGFjdGlvbi5kYXRhLmdldEJsb2cudGl0bGU7XG4gICAgICAgICAgICBkYXRhLmRhdGUgPSBhY3Rpb24uZGF0YS5nZXRCbG9nLmRhdGU7XG4gICAgICAgICAgICBkYXRhLnB1YmxpYyA9ICEhYWN0aW9uLmRhdGEuZ2V0QmxvZy5wdWJsaWM7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnQkxPR19HRVRfRVJST1InOlxuICAgICAgICAgICAgcmV0dXJuIF9leHRlbmRzKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgZXJyb3I6IGFjdGlvbi5lcnJvclxuICAgICAgICAgICAgfSwgc3RhdGUpO1xuXG4gICAgICAgIGNhc2UgJ0JMT0dfRURJVF9TRU5EJzpcbiAgICAgICAgICAgIGRhdGEgPSBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc2VuZCc7XG4gICAgICAgICAgICBkYXRhLmlkID0gYWN0aW9uLmlkO1xuICAgICAgICAgICAgZGF0YS50ZXh0ID0gYWN0aW9uLnRleHQ7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gYWN0aW9uLnRpdGxlO1xuICAgICAgICAgICAgZGF0YS5wdWJsaWMgPSBhY3Rpb24ucHVibGljO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0JMT0dfRURJVF9TVUNDRVNTJzpcbiAgICAgICAgICAgIGRhdGEgPSBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc3VjY2Vzc19lZGl0JztcbiAgICAgICAgICAgIGRhdGEuaWQgPSBhY3Rpb24uZGF0YS5lZGl0QmxvZy5pZDtcbiAgICAgICAgICAgIGRhdGEudGV4dCA9IGFjdGlvbi5kYXRhLmVkaXRCbG9nLnRleHQ7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gYWN0aW9uLmRhdGEuZWRpdEJsb2cudGl0bGU7XG4gICAgICAgICAgICBkYXRhLnB1YmxpYyA9IGFjdGlvbi5kYXRhLmVkaXRCbG9nLnB1YmxpYztcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICBjYXNlICdCTE9HX0VESVRfRVJST1InOlxuICAgICAgICAgICAgZGF0YSA9IF9leHRlbmRzKHt9LCBzdGF0ZSk7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG59O1xuXG5leHBvcnRzLmRlZmF1bHQgPSBibG9nRWRpdDtcblxuLyoqKi8gfSlcblxufSxbMzI2XSk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGJsb2dFZGl0LmpzIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlYWN0LXJlZHV4J1xuaW1wb3J0IHthcGksIGdyYXBocWx9IGZyb20gJy4uL2hlbHBlcnMvYWN0aW9uJ1xuaW1wb3J0IHtBbGVydE1lc3NhZ2V9IGZyb20gJy4uL2hlbHBlcnMvY29tcG9uZW50J1xuXG5pbXBvcnQgeyBFZGl0b3JTdGF0ZSwgY29udmVydFRvUmF3LCBDb250ZW50U3RhdGUgfSBmcm9tICdkcmFmdC1qcyc7XG5pbXBvcnQgZHJhZnRUb0h0bWwgZnJvbSAnZHJhZnRqcy10by1odG1sJztcbmltcG9ydCBodG1sVG9EcmFmdCBmcm9tICdodG1sLXRvLWRyYWZ0anMnO1xuaW1wb3J0IHsgRWRpdG9yIH0gZnJvbSAncmVhY3QtZHJhZnQtd3lzaXd5Zyc7XG5cblxuXG5jbGFzcyBFZGl0Q29tcCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0gey4uLnByb3BzLmJsb2dFZGl0fTtcbiAgICAgICAgdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLmNyZWF0ZUVtcHR5KCk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbE1vdW50ICgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaWQgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICB0eXBlOiAnQkxPR19HRVQnLFxuICAgICAgICAgICAgaWQ6IHRoaXMuc3RhdGUuaWQsXG4gICAgICAgIH0pKTtcblxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICBpZiAobmV4dFByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PSAnc3VjY2Vzc19nZXQnKSB7XG4gICAgICAgICAgICBjb25zdCBibG9ja3NGcm9tSFRNTCA9IGh0bWxUb0RyYWZ0KG5leHRQcm9wcy5ibG9nRWRpdC50ZXh0KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBDb250ZW50U3RhdGUuY3JlYXRlRnJvbUJsb2NrQXJyYXkoXG4gICAgICAgICAgICAgICAgYmxvY2tzRnJvbUhUTUwuY29udGVudEJsb2NrcyxcbiAgICAgICAgICAgICAgICBibG9ja3NGcm9tSFRNTC5lbnRpdHlNYXBcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBuZXh0UHJvcHMuYmxvZ0VkaXQudGl0bGUsXG4gICAgICAgICAgICAgICAgdGV4dDogbmV4dFByb3BzLmJsb2dFZGl0LnRleHQsXG4gICAgICAgICAgICAgICAgcHVibGljOiBuZXh0UHJvcHMuYmxvZ0VkaXQucHVibGljLFxuICAgICAgICAgICAgICAgIGRhdGU6IG5leHRQcm9wcy5ibG9nRWRpdC5kYXRlLFxuICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBFZGl0b3JTdGF0ZS5jcmVhdGVXaXRoQ29udGVudChjb250ZW50KSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxuICAgIGZpZWxkQ2hhbmdlIChlKSB7XG4gICAgICAgIGxldCBzdGF0ZU9iaiA9IHt9O1xuICAgICAgICBsZXQgdmFsID0gKGUudGFyZ2V0LmlkID09ICdwdWJsaWMnKSA/IGUudGFyZ2V0LmNoZWNrZWQgOiBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgc3RhdGVPYmpbZS50YXJnZXQuaWRdID0gdmFsO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlT2JqKTtcbiAgICB9XG5cbiAgICBvbkVkaXRvclN0YXRlQ2hhbmdlIChlZGl0b3JTdGF0ZSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGVkaXRvclN0YXRlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBmb3JtU3VibWl0IChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IHRleHQgPSBkcmFmdFRvSHRtbChjb252ZXJ0VG9SYXcodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKSk7XG5cbiAgICAgICAgaWYgKHRleHQgJiYgKHRleHQubGVuZ3RoID4gNTEyKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdCTE9HX0VESVRfRVJST1InLFxuICAgICAgICAgICAgICAgIGVycm9yOiAnVGV4dCBpcyB0b28gbG9uZyEnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnByb3BzLmRpc3BhdGNoKGdyYXBocWwoe1xuICAgICAgICAgICAgdHlwZTogJ0JMT0dfRURJVCcsXG4gICAgICAgICAgICBpZDogdGhpcy5zdGF0ZS5pZCxcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnN0YXRlLnRpdGxlLFxuICAgICAgICAgICAgdGV4dDogZHJhZnRUb0h0bWwoY29udmVydFRvUmF3KHRoaXMuc3RhdGUuZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSkpLFxuICAgICAgICAgICAgcHVibGljOiB0aGlzLnN0YXRlLnB1YmxpYyxcbiAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHJlbmRlciAoKSB7XG4gICAgICAgIGxldCBhbGVydE9wdHMgPSBudWxsO1xuICAgIFxuICAgICAgICBpZiAodGhpcy5wcm9wcy5ibG9nRWRpdC5zdGF0dXMgPT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdkYW5nZXInLFxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMucHJvcHMuYmxvZ0VkaXQuZXJyb3IgfHwgJ0Vycm9yLCB3cm9uZyBibG9nIGRhdGEnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5ibG9nRWRpdC5zdGF0dXMgPT09ICdzZW5kJykge1xuICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2luZm8nLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdMb2FkaW5nLCBwbGVhc2Ugd2FpdCcsXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5ibG9nRWRpdC5zdGF0dXMgPT09ICdzdWNjZXNzX2VkaXQnKSB7XG4gICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0Jsb2cgc2F2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvYmxvZy1lZGl0LycgKyB0aGlzLnByb3BzLmJsb2dFZGl0LmlkO1xuICAgICAgICAgICAgfSwgMTAwMClcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgPGZvcm0gb25TdWJtaXQ9ezo6dGhpcy5mb3JtU3VibWl0fSA+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwidGl0bGVcIj5UaXRsZTwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxpbnB1dCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiIFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiZm9ybS1jb250cm9sXCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZD1cInRpdGxlXCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlRpdGxlXCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17Ojp0aGlzLmZpZWxkQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUudGl0bGV9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwidGV4dFwiPlRleHQ8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICA8RWRpdG9yXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZT17dGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvckNsYXNzTmFtZT1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkVkaXRvclN0YXRlQ2hhbmdlPXs6OnRoaXMub25FZGl0b3JTdGF0ZUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXI9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBbJ2lubGluZScsICdsaXN0JywgJ2ZvbnRTaXplJywgJ2ZvbnRGYW1pbHknLCAndGV4dEFsaWduJywgJ2xpbmsnLCAnaGlzdG9yeScsICdjb2xvclBpY2tlciddLFxuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2hlY2tib3hcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJjaGVja2JveFwiIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPSdwdWJsaWMnIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXs6OnRoaXMuZmllbGRDaGFuZ2V9IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQgPSB7ISEgdGhpcy5zdGF0ZS5wdWJsaWN9XG4gICAgICAgICAgICAgICAgICAgICAgICAvPiBQdWJsaWNcbiAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgIDxBbGVydE1lc3NhZ2Ugb3B0cz17YWxlcnRPcHRzfSAvPlxuXG4gICAgICAgICAgICAgICAgPGhyIC8+XG4gICAgICAgICAgICAgICAgPGRpdiA+XG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzTmFtZT1cImJ0biBidG4tcHJpbWFyeVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSdnbHlwaGljb24gZ2x5cGhpY29uLWZsb3BweS1kaXNrJz48L3NwYW4+Jm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBTYXZlXG4gICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxiciAvPlxuICAgICAgICAgICAgPC9mb3JtPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgXG4gICAgfVxufVxuXG5jb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSAoc3RhdGUpID0+IHtcbiAgICByZXR1cm4gey4uLnN0YXRlfVxufVxuRWRpdENvbXAgPSBjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcykoRWRpdENvbXApXG5leHBvcnQgZGVmYXVsdCBFZGl0Q29tcFxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3RhdGljX3NyYy9ibG9nL0VkaXRDb21wLmpzIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgcmVuZGVyIH0gZnJvbSAncmVhY3QtZG9tJ1xuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICdyZWFjdC1yZWR1eCdcblxuaW1wb3J0ICdib290c3RyYXAvZGlzdC9jc3MvYm9vdHN0cmFwLmNzcyc7XG5pbXBvcnQgJ3JlYWN0LWRyYWZ0LXd5c2l3eWcvZGlzdC9yZWFjdC1kcmFmdC13eXNpd3lnLmNzcyc7XG5pbXBvcnQgJy4vc3R5bGVzL2luZGV4LnNjc3MnXG5cbmltcG9ydCB7bGF5b3V0fSBmcm9tICcuL2hlbHBlcnMvY29tcG9uZW50J1xuaW1wb3J0IEVkaXRDb21wIGZyb20gJy4vYmxvZy9FZGl0Q29tcCdcblxuaW1wb3J0IGF1dGggZnJvbSAnLi9hdXRoL0xvZ2luUmVkJ1xuaW1wb3J0IGJsb2dFZGl0IGZyb20gJy4vYmxvZy9FZGl0UmVkJ1xuXG5pbXBvcnQge2NvbmZpZ3VyZVN0b3JlfSBmcm9tICcuL2hlbHBlcnMvY29uZmlndXJlU3RvcmUnXG5cblxubGV0IHN0b3JlID0gY29uZmlndXJlU3RvcmUoe1xuXHRhdXRoOiBhdXRoLFxuXHRibG9nRWRpdDogYmxvZ0VkaXQsXG59KTtcblxubGV0IENvbXAgPSBsYXlvdXQoe2NvbXA6IEVkaXRDb21wLCBmb3JBdXRoOiB0cnVlfSk7XG5yZW5kZXIoXG5cdDxQcm92aWRlciBzdG9yZT17c3RvcmV9PlxuXHRcdDxDb21wIC8+XG5cdDwvUHJvdmlkZXI+LFxuXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpXG4pXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zdGF0aWNfc3JjL2Jsb2dFZGl0LmpzIiwibGV0IGJsb2dJZCA9IHdpbmRvdy5sb2NhbFBhcmFtcy5ibG9nSWQgfHwgJy0xJztcbmxldCBpbml0U3RhdGUgPSB7XG4gICAgaWQ6IHBhcnNlSW50KGJsb2dJZCksXG4gICAgdXNlcl9pZDogMCxcbiAgICB1c2VyX25hbWU6ICcnLFxuICAgIHRpdGxlOiAnJyxcbiAgICB0ZXh0OiAnJyxcbiAgICBkYXRlOiAnJyxcbiAgICBwdWJsaWM6IGZhbHNlLFxuICAgIHN0YXR1czogbnVsbCxcbn07XG5cbmNvbnN0IGJsb2dFZGl0ID0gKHN0YXRlID0gaW5pdFN0YXRlLCBhY3Rpb24pID0+IHtcbiAgICBsZXQgZGF0YSA9IG51bGw7XG5cbiAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgJ0JMT0dfR0VUX1NFTkQnOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdzZW5kJyxcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSAnQkxPR19HRVRfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhID0gey4uLnN0YXRlfTtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3NfZ2V0JztcbiAgICAgICAgICAgIGRhdGEuaWQgPSBhY3Rpb24uZGF0YS5nZXRCbG9nLmlkO1xuICAgICAgICAgICAgZGF0YS51c2VyX2lkID0gYWN0aW9uLmRhdGEuZ2V0QmxvZy51c2VySWQ7XG4gICAgICAgICAgICBkYXRhLnVzZXJfbmFtZSA9IGFjdGlvbi5kYXRhLmdldEJsb2cudXNlck5hbWU7XG4gICAgICAgICAgICBkYXRhLnRleHQgPSBhY3Rpb24uZGF0YS5nZXRCbG9nLnRleHQ7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gYWN0aW9uLmRhdGEuZ2V0QmxvZy50aXRsZTtcbiAgICAgICAgICAgIGRhdGEuZGF0ZSA9IGFjdGlvbi5kYXRhLmdldEJsb2cuZGF0ZTtcbiAgICAgICAgICAgIGRhdGEucHVibGljID0gISEgYWN0aW9uLmRhdGEuZ2V0QmxvZy5wdWJsaWM7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnQkxPR19HRVRfRVJST1InOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgZXJyb3I6IGFjdGlvbi5lcnJvcixcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgY2FzZSAnQkxPR19FRElUX1NFTkQnOlxuICAgICAgICAgICAgZGF0YSA9IHsuLi5zdGF0ZX07XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzZW5kJztcbiAgICAgICAgICAgIGRhdGEuaWQgPSBhY3Rpb24uaWQ7XG4gICAgICAgICAgICBkYXRhLnRleHQgPSBhY3Rpb24udGV4dDtcbiAgICAgICAgICAgIGRhdGEudGl0bGUgPSBhY3Rpb24udGl0bGU7XG4gICAgICAgICAgICBkYXRhLnB1YmxpYyA9IGFjdGlvbi5wdWJsaWM7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgY2FzZSAnQkxPR19FRElUX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YSA9IHsuLi5zdGF0ZX07XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzX2VkaXQnO1xuICAgICAgICAgICAgZGF0YS5pZCA9IGFjdGlvbi5kYXRhLmVkaXRCbG9nLmlkO1xuICAgICAgICAgICAgZGF0YS50ZXh0ID0gYWN0aW9uLmRhdGEuZWRpdEJsb2cudGV4dDtcbiAgICAgICAgICAgIGRhdGEudGl0bGUgPSBhY3Rpb24uZGF0YS5lZGl0QmxvZy50aXRsZTtcbiAgICAgICAgICAgIGRhdGEucHVibGljID0gYWN0aW9uLmRhdGEuZWRpdEJsb2cucHVibGljO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIGNhc2UgJ0JMT0dfRURJVF9FUlJPUic6XG4gICAgICAgICAgICBkYXRhID0gey4uLnN0YXRlfTtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ2Vycm9yJztcbiAgICAgICAgICAgIGRhdGEuZXJyb3IgPSBhY3Rpb24uZXJyb3I7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcblxuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gc3RhdGVcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJsb2dFZGl0XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3RhdGljX3NyYy9ibG9nL0VkaXRSZWQuanMiXSwic291cmNlUm9vdCI6IiJ9