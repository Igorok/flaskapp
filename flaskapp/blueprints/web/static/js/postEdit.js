webpackJsonp([1],{417:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=a(2),o=r(i),s=a(12),n=a(8);a(24),a(145),a(25);var l=a(9),d=a(418),u=r(d),c=a(26),p=r(c),f=a(419),h=r(f),m=a(27),b=(0,m.configureStore)({auth:p.default,postEdit:h.default}),E=(0,l.layout)({comp:u.default,forAuth:!0});(0,s.render)(o.default.createElement(n.Provider,{store:b},o.default.createElement(E,null)),document.getElementById("root"))},418:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},l=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),d=a(2),u=r(d),c=a(8),p=a(29),f=a(9),h=a(40),m=a(171),b=r(m),E=a(172),g=r(E),y=a(173),v=function(t){function e(t){i(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a.state=n({},t.postEdit),a.state.editorState=h.EditorState.createEmpty(),a}return s(e,t),l(e,[{key:"componentWillMount",value:function(){-1!==this.state.id&&this.props.dispatch((0,p.graphql)({type:"MY_POST_GET",id:this.state.id,blogId:this.state.blogId}))}},{key:"componentWillReceiveProps",value:function(t){if("success_get"==t.postEdit.status){var e=(0,g.default)(t.postEdit.text),a=h.ContentState.createFromBlockArray(e.contentBlocks,e.entityMap);this.setState({userId:t.postEdit.userId,userName:t.postEdit.userName,userEmail:t.postEdit.userEmail,title:t.postEdit.title,description:t.postEdit.description,text:t.postEdit.text,date:t.postEdit.date,public:t.postEdit.public,editorState:h.EditorState.createWithContent(a)})}}},{key:"fieldChange",value:function(t){var e={},a="public"==t.target.id?t.target.checked:t.target.value;e[t.target.id]=a,this.setState(e)}},{key:"onEditorStateChange",value:function(t){this.setState({editorState:t})}},{key:"formSubmit",value:function(t){t.preventDefault();var e=(0,b.default)((0,h.convertToRaw)(this.state.editorState.getCurrentContent()));this.props.dispatch((0,p.graphql)({type:"POST_EDIT",id:this.state.id,blogId:this.state.blogId,title:this.state.title,description:this.state.description,text:e,public:this.state.public}))}},{key:"render",value:function(){var t=this,e=null;return"error"===this.props.postEdit.status?e={className:"danger",text:this.props.postEdit.error||"Error, wrong post data"}:"send"===this.props.postEdit.status?e={className:"info",text:"Loading, please wait"}:"success_edit"===this.props.postEdit.status&&(e={className:"success",text:"Post saved successfully"},setTimeout(function(){window.location="/post-edit/"+t.props.postEdit.blogId+"/"+t.props.postEdit.id},1e3)),u.default.createElement("div",null,u.default.createElement("form",{onSubmit:this.formSubmit.bind(this)},u.default.createElement("div",{className:"form-group"},u.default.createElement("label",{htmlFor:"title"},"Title"),u.default.createElement("input",{required:!0,type:"text",className:"form-control",id:"title",placeholder:"Title",onChange:this.fieldChange.bind(this),value:this.state.title})),u.default.createElement("div",{className:"form-group"},u.default.createElement("label",{htmlFor:"description"},"Description"),u.default.createElement("input",{required:!0,type:"text",className:"form-control",id:"description",placeholder:"Description",onChange:this.fieldChange.bind(this),value:this.state.description})),u.default.createElement("div",{className:"form-group"},u.default.createElement("label",{htmlFor:"text"},"Text"),u.default.createElement(y.Editor,{editorState:this.state.editorState,editorClassName:"form-control",onEditorStateChange:this.onEditorStateChange.bind(this),toolbar:{options:["inline","list","fontSize","fontFamily","textAlign","link","history","colorPicker"]}})),u.default.createElement("div",{className:"checkbox"},u.default.createElement("label",null,u.default.createElement("input",{type:"checkbox",id:"public",onChange:this.fieldChange.bind(this),checked:!!this.state.public})," Public")),u.default.createElement(f.AlertMessage,{opts:e}),u.default.createElement("hr",null),u.default.createElement("div",null,u.default.createElement("button",{type:"submit",className:"btn btn-primary"},u.default.createElement("span",{className:"glyphicon glyphicon-floppy-disk"}),"Â  Save")),u.default.createElement("br",null)))}}]),e}(u.default.Component),P=function(t){return n({},t)};v=(0,c.connect)(P)(v),e.default=v},419:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},i=window.localParams.blogId,o=window.localParams.postId||"-1",s={id:parseInt(o),blogId:parseInt(i),userId:0,userName:"",userEmail:"",title:"",description:"",text:"",date:"",public:!1,status:null},n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,e=arguments[1],a=null;switch(e.type){case"MY_POST_GET_SEND":return r({status:"send"},t);case"MY_POST_GET_SUCCESS":return a=r({},t),a.status="success_get",a.id=e.data.getMyPost.id,a.blogId=e.data.getMyPost.blogId,a.userId=e.data.getMyPost.userId,a.userName=e.data.getMyPost.userName,a.userEmail=e.data.getMyPost.userEmail,a.title=e.data.getMyPost.title,a.description=e.data.getMyPost.description,a.text=e.data.getMyPost.text,a.date=e.data.getMyPost.date,a.public=!!e.data.getMyPost.public,a;case"MY_POST_GET_ERROR":return r({status:"error",error:e.error},t);case"POST_EDIT_SEND":return a=r({},t),a.status="send",a.id=e.id,a.blogId=e.blogId,a.title=e.title,a.description=e.description,a.text=e.text,a.public=e.public,a;case"POST_EDIT_SUCCESS":return a=r({},t),a.status="success_edit",a.id=e.data.editPost.id,a.blogId=e.data.editPost.blogId,a.title=e.data.editPost.title,a.description=e.data.editPost.description,a.text=e.data.editPost.text,a.date=e.data.editPost.date,a.public=e.data.editPost.public,a;case"POST_EDIT_ERROR":return a=r({},t),a.status="error",a.error=e.error,a;default:return t}};e.default=n}},[417]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vcG9zdEVkaXQuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy9wb3N0RWRpdC5qcyIsIndlYnBhY2s6Ly8vLi9zdGF0aWNfc3JjL3Bvc3QvRWRpdENvbXAuanMiLCJ3ZWJwYWNrOi8vLy4vc3RhdGljX3NyYy9wb3N0L0VkaXRSZWQuanMiXSwibmFtZXMiOlsid2VicGFja0pzb25wIiwiNDE3IiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfcmVhY3QiLCJfcmVhY3QyIiwiX3JlYWN0RG9tIiwiX3JlYWN0UmVkdXgiLCJfY29tcG9uZW50IiwiX0VkaXRDb21wIiwiX0VkaXRDb21wMiIsIl9Mb2dpblJlZCIsIl9Mb2dpblJlZDIiLCJfRWRpdFJlZCIsIl9FZGl0UmVkMiIsIl9jb25maWd1cmVTdG9yZSIsInN0b3JlIiwiY29uZmlndXJlU3RvcmUiLCJhdXRoIiwicG9zdEVkaXQiLCJDb21wIiwibGF5b3V0IiwiY29tcCIsIkVkaXRDb21wIiwiZm9yQXV0aCIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJQcm92aWRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCI0MTgiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJzZWxmIiwiY2FsbCIsIlJlZmVyZW5jZUVycm9yIiwiX2luaGVyaXRzIiwic3ViQ2xhc3MiLCJzdXBlckNsYXNzIiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiY29uc3RydWN0b3IiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJ3cml0YWJsZSIsImNvbmZpZ3VyYWJsZSIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiZGVmaW5lUHJvcGVydHkiLCJfZXh0ZW5kcyIsImFzc2lnbiIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJwcm9wcyIsImRlc2NyaXB0b3IiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJfYWN0aW9uIiwiX2RyYWZ0SnMiLCJfZHJhZnRqc1RvSHRtbCIsIl9kcmFmdGpzVG9IdG1sMiIsIl9odG1sVG9EcmFmdGpzIiwiX2h0bWxUb0RyYWZ0anMyIiwiX3JlYWN0RHJhZnRXeXNpd3lnIiwiX1JlYWN0JENvbXBvbmVudCIsInRoaXMiLCJfdGhpcyIsImdldFByb3RvdHlwZU9mIiwic3RhdGUiLCJlZGl0b3JTdGF0ZSIsIkVkaXRvclN0YXRlIiwiY3JlYXRlRW1wdHkiLCJpZCIsImRpc3BhdGNoIiwiZ3JhcGhxbCIsInR5cGUiLCJibG9nSWQiLCJuZXh0UHJvcHMiLCJzdGF0dXMiLCJibG9ja3NGcm9tSFRNTCIsInRleHQiLCJjb250ZW50IiwiQ29udGVudFN0YXRlIiwiY3JlYXRlRnJvbUJsb2NrQXJyYXkiLCJjb250ZW50QmxvY2tzIiwiZW50aXR5TWFwIiwic2V0U3RhdGUiLCJ1c2VySWQiLCJ1c2VyTmFtZSIsInVzZXJFbWFpbCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJkYXRlIiwicHVibGljIiwiY3JlYXRlV2l0aENvbnRlbnQiLCJlIiwic3RhdGVPYmoiLCJ2YWwiLCJjaGVja2VkIiwicHJldmVudERlZmF1bHQiLCJjb252ZXJ0VG9SYXciLCJnZXRDdXJyZW50Q29udGVudCIsIl90aGlzMiIsImFsZXJ0T3B0cyIsImNsYXNzTmFtZSIsImVycm9yIiwic2V0VGltZW91dCIsIndpbmRvdyIsImxvY2F0aW9uIiwib25TdWJtaXQiLCJmb3JtU3VibWl0IiwiYmluZCIsImh0bWxGb3IiLCJyZXF1aXJlZCIsInBsYWNlaG9sZGVyIiwib25DaGFuZ2UiLCJmaWVsZENoYW5nZSIsIkVkaXRvciIsImVkaXRvckNsYXNzTmFtZSIsIm9uRWRpdG9yU3RhdGVDaGFuZ2UiLCJ0b29sYmFyIiwib3B0aW9ucyIsIkFsZXJ0TWVzc2FnZSIsIm9wdHMiLCJSZWFjdCIsIkNvbXBvbmVudCIsIm1hcFN0YXRlVG9Qcm9wcyIsImNvbm5lY3QiLCI0MTkiLCJsb2NhbFBhcmFtcyIsInBvc3RJZCIsImluaXRTdGF0ZSIsInBhcnNlSW50IiwidW5kZWZpbmVkIiwiYWN0aW9uIiwiZGF0YSIsImdldE15UG9zdCIsImVkaXRQb3N0Il0sIm1hcHBpbmdzIjoiQUFBQUEsY0FBYyxJQUVSQyxJQUNBLFNBQVVDLEVBQVFDLEVBQVNDLEdBRWpDLFlBaUNBLFNBQVNDLEdBQXVCQyxHQUFPLE1BQU9BLElBQU9BLEVBQUlDLFdBQWFELEdBQVFFLFFBQVNGLEdDdEN2RixHQUFBRyxHQUFBTCxFQUFBLEdEVUlNLEVBQVVMLEVBQXVCSSxHQ1RyQ0UsRUFBQVAsRUFBQSxJQUNBUSxFQUFBUixFQUFBLEVBRUFBLEdBQUEsSUFDQUEsRUFBQSxLQUNBQSxFQUFBLEdBRUEsSUFBQVMsR0FBQVQsRUFBQSxHQUNBVSxFQUFBVixFQUFBLEtEaUJJVyxFQUFhVixFQUF1QlMsR0NmeENFLEVBQUFaLEVBQUEsSURtQklhLEVBQWFaLEVBQXVCVyxHQ2xCeENFLEVBQUFkLEVBQUEsS0RzQkllLEVBQVlkLEVBQXVCYSxHQ3BCdkNFLEVBQUFoQixFQUFBLElBR0lpQixHQUFRLEVBQUFELEVBQUFFLGlCQUNYQyxLQUFNQSxVQUNOQyxTQUFVQSxZQUdQQyxHQUFPLEVBQUFaLEVBQUFhLFNBQVFDLEtBQU1DLFVBQVVDLFNBQVMsS0FDNUMsRUFBQWxCLEVBQUFtQixRQUNDcEIsRUFBQUYsUUFBQXVCLGNBQUNuQixFQUFBb0IsVUFBU1gsTUFBT0EsR0FDaEJYLEVBQUFGLFFBQUF1QixjQUFDTixFQUFELE9BRURRLFNBQVNDLGVBQWUsVUQyQm5CQyxJQUNBLFNBQVVqQyxFQUFRQyxFQUFTQyxHQUVqQyxZQWlDQSxTQUFTQyxHQUF1QkMsR0FBTyxNQUFPQSxJQUFPQSxFQUFJ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QUFLMUMsU0FBWXlDLEVBQU9DLEtBQUtDLFVBQVUzQyxPQUNoQzBDLENBRVgsS0FBSyxvQkFDRCxNQUFBN0YsSUFDSW9DLE9BQVEsUUFDUjJCLE1BQU82QixFQUFPN0IsT0FDWHJDLEVBR1gsS0FBSyxpQkFTRCxNQVJBbUUsUUFBV25FLEdBQ1htRSxFQUFLekQsT0FBUyxPQUNkeUQsRUFBSy9ELEdBQUs4RCxFQUFPOUQsR0FDakIrRCxFQUFLM0QsT0FBUzBELEVBQU8xRCxPQUNyQjJELEVBQUs3QyxNQUFRNEMsRUFBTzVDLE1BQ3BCNkMsRUFBSzVDLFlBQWMyQyxFQUFPM0MsWUFDMUI0QyxFQUFLdkQsS0FBT3NELEVBQU90RCxLQUNuQnVELEVBQUsxQyxPQUFTeUMsRUFBT3pDLE9BQ2QwQyxDQUVYLEtBQUssb0JBVUQsTUFUQUEsUUFBV25FLEdBQ1htRSxFQUFLekQsT0FBUyxlQUNkeUQsRUFBSy9ELEdBQUs4RCxFQUFPQyxLQUFLRSxTQUFTakUsR0FDL0IrRCxFQUFLM0QsT0FBUzBELEVBQU9DLEtBQUtFLFNBQVM3RCxPQUNuQzJELEVBQUs3QyxNQUFRNEMsRUFBT0MsS0FBS0UsU0FBUy9DLE1BQ2xDNkMsRUFBSzVDLFlBQWMyQyxFQUFPQyxLQUFLRSxTQUFTOUMsWUFDeEM0QyxFQUFLdkQsS0FBT3NELEVBQU9DLEtBQUtFLFNBQVN6RCxLQUNqQ3VELEVBQUszQyxLQUFPMEMsRUFBT0MsS0FBS0UsU0FBUzdDLEtBQ2pDMkMsRUFBSzFDLE9BQVN5QyxFQUFPQyxLQUFLRSxTQUFTNUMsT0FDNUIwQyxDQUVYLEtBQUssa0JBSUQsTUFIQUEsUUFBV25FLEdBQ1htRSxFQUFLekQsT0FBUyxRQUNkeUQsRUFBSzlCLE1BQVE2QixFQUFPN0IsTUFDYjhCLENBR1gsU0FDSSxNQUFPbkUsSUhzZW5CakYsR0FBUUssUUdsZU9nQixLSHNlWiIsImZpbGUiOiJwb3N0RWRpdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIndlYnBhY2tKc29ucChbMV0se1xuXG4vKioqLyA0MTc6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5cbnZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9yZWFjdERvbSA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpO1xuXG52YXIgX3JlYWN0UmVkdXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpO1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXygxNDUpO1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTtcblxudmFyIF9jb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpO1xuXG52YXIgX0VkaXRDb21wID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTgpO1xuXG52YXIgX0VkaXRDb21wMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0VkaXRDb21wKTtcblxudmFyIF9Mb2dpblJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oMjYpO1xuXG52YXIgX0xvZ2luUmVkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xvZ2luUmVkKTtcblxudmFyIF9FZGl0UmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTkpO1xuXG52YXIgX0VkaXRSZWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRWRpdFJlZCk7XG5cbnZhciBfY29uZmlndXJlU3RvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxudmFyIHN0b3JlID0gKDAsIF9jb25maWd1cmVTdG9yZS5jb25maWd1cmVTdG9yZSkoe1xuXHRhdXRoOiBfTG9naW5SZWQyLmRlZmF1bHQsXG5cdHBvc3RFZGl0OiBfRWRpdFJlZDIuZGVmYXVsdFxufSk7XG5cbnZhciBDb21wID0gKDAsIF9jb21wb25lbnQubGF5b3V0KSh7IGNvbXA6IF9FZGl0Q29tcDIuZGVmYXVsdCwgZm9yQXV0aDogdHJ1ZSB9KTtcbigwLCBfcmVhY3REb20ucmVuZGVyKShfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcblx0X3JlYWN0UmVkdXguUHJvdmlkZXIsXG5cdHsgc3RvcmU6IHN0b3JlIH0sXG5cdF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KENvbXAsIG51bGwpXG4pLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpKTtcblxuLyoqKi8gfSksXG5cbi8qKiovIDQxODpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gICAgdmFsdWU6IHRydWVcbn0pO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXG52YXIgX3JlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcmVhY3RSZWR1eCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7XG5cbnZhciBfYWN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7XG5cbnZhciBfY29tcG9uZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTtcblxudmFyIF9kcmFmdEpzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MCk7XG5cbnZhciBfZHJhZnRqc1RvSHRtbCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcxKTtcblxudmFyIF9kcmFmdGpzVG9IdG1sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RyYWZ0anNUb0h0bWwpO1xuXG52YXIgX2h0bWxUb0RyYWZ0anMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3Mik7XG5cbnZhciBfaHRtbFRvRHJhZnRqczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9odG1sVG9EcmFmdGpzKTtcblxudmFyIF9yZWFjdERyYWZ0V3lzaXd5ZyA9IF9fd2VicGFja19yZXF1aXJlX18oMTczKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSA/IGNhbGwgOiBzZWxmOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgRWRpdENvbXAgPSBmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhFZGl0Q29tcCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBFZGl0Q29tcChwcm9wcykge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRWRpdENvbXApO1xuXG4gICAgICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChFZGl0Q29tcC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKEVkaXRDb21wKSkuY2FsbCh0aGlzLCBwcm9wcykpO1xuXG4gICAgICAgIF90aGlzLnN0YXRlID0gX2V4dGVuZHMoe30sIHByb3BzLnBvc3RFZGl0KTtcbiAgICAgICAgX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGUgPSBfZHJhZnRKcy5FZGl0b3JTdGF0ZS5jcmVhdGVFbXB0eSgpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKEVkaXRDb21wLCBbe1xuICAgICAgICBrZXk6ICdjb21wb25lbnRXaWxsTW91bnQnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaWQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnByb3BzLmRpc3BhdGNoKCgwLCBfYWN0aW9uLmdyYXBocWwpKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnTVlfUE9TVF9HRVQnLFxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLnN0YXRlLmlkLFxuICAgICAgICAgICAgICAgIGJsb2dJZDogdGhpcy5zdGF0ZS5ibG9nSWRcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcycsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICAgICAgaWYgKG5leHRQcm9wcy5wb3N0RWRpdC5zdGF0dXMgPT0gJ3N1Y2Nlc3NfZ2V0Jykge1xuICAgICAgICAgICAgICAgIHZhciBibG9ja3NGcm9tSFRNTCA9ICgwLCBfaHRtbFRvRHJhZnRqczIuZGVmYXVsdCkobmV4dFByb3BzLnBvc3RFZGl0LnRleHQpO1xuICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gX2RyYWZ0SnMuQ29udGVudFN0YXRlLmNyZWF0ZUZyb21CbG9ja0FycmF5KGJsb2Nrc0Zyb21IVE1MLmNvbnRlbnRCbG9ja3MsIGJsb2Nrc0Zyb21IVE1MLmVudGl0eU1hcCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBuZXh0UHJvcHMucG9zdEVkaXQudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogbmV4dFByb3BzLnBvc3RFZGl0LnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICB1c2VyRW1haWw6IG5leHRQcm9wcy5wb3N0RWRpdC51c2VyRW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBuZXh0UHJvcHMucG9zdEVkaXQudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBuZXh0UHJvcHMucG9zdEVkaXQuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IG5leHRQcm9wcy5wb3N0RWRpdC50ZXh0LFxuICAgICAgICAgICAgICAgICAgICBkYXRlOiBuZXh0UHJvcHMucG9zdEVkaXQuZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgcHVibGljOiBuZXh0UHJvcHMucG9zdEVkaXQucHVibGljLFxuICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogX2RyYWZ0SnMuRWRpdG9yU3RhdGUuY3JlYXRlV2l0aENvbnRlbnQoY29udGVudClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZmllbGRDaGFuZ2UnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZmllbGRDaGFuZ2UoZSkge1xuICAgICAgICAgICAgdmFyIHN0YXRlT2JqID0ge307XG4gICAgICAgICAgICB2YXIgdmFsID0gZS50YXJnZXQuaWQgPT0gJ3B1YmxpYycgPyBlLnRhcmdldC5jaGVja2VkIDogZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICBzdGF0ZU9ialtlLnRhcmdldC5pZF0gPSB2YWw7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlT2JqKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnb25FZGl0b3JTdGF0ZUNoYW5nZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkVkaXRvclN0YXRlQ2hhbmdlKGVkaXRvclN0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogZWRpdG9yU3RhdGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdmb3JtU3VibWl0JyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1TdWJtaXQoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIHRleHQgPSAoMCwgX2RyYWZ0anNUb0h0bWwyLmRlZmF1bHQpKCgwLCBfZHJhZnRKcy5jb252ZXJ0VG9SYXcpKHRoaXMuc3RhdGUuZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSkpO1xuXG4gICAgICAgICAgICB0aGlzLnByb3BzLmRpc3BhdGNoKCgwLCBfYWN0aW9uLmdyYXBocWwpKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVF9FRElUJyxcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5zdGF0ZS5pZCxcbiAgICAgICAgICAgICAgICBibG9nSWQ6IHRoaXMuc3RhdGUuYmxvZ0lkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnN0YXRlLnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnN0YXRlLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICAgICAgcHVibGljOiB0aGlzLnN0YXRlLnB1YmxpY1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdyZW5kZXInLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBhbGVydE9wdHMgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5wb3N0RWRpdC5zdGF0dXMgPT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMucHJvcHMucG9zdEVkaXQuZXJyb3IgfHwgJ0Vycm9yLCB3cm9uZyBwb3N0IGRhdGEnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5wb3N0RWRpdC5zdGF0dXMgPT09ICdzZW5kJykge1xuICAgICAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnaW5mbycsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdMb2FkaW5nLCBwbGVhc2Ugd2FpdCdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnBvc3RFZGl0LnN0YXR1cyA9PT0gJ3N1Y2Nlc3NfZWRpdCcpIHtcbiAgICAgICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnUG9zdCBzYXZlZCBzdWNjZXNzZnVsbHknXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9wb3N0LWVkaXQvJyArIF90aGlzMi5wcm9wcy5wb3N0RWRpdC5ibG9nSWQgKyAnLycgKyBfdGhpczIucHJvcHMucG9zdEVkaXQuaWQ7XG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZm9ybScsXG4gICAgICAgICAgICAgICAgICAgIHsgb25TdWJtaXQ6IHRoaXMuZm9ybVN1Ym1pdC5iaW5kKHRoaXMpIH0sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2Zvcm0tZ3JvdXAnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaHRtbEZvcjogJ3RpdGxlJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUaXRsZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Zvcm0tY29udHJvbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICd0aXRsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdUaXRsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMuZmllbGRDaGFuZ2UuYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS50aXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnZm9ybS1ncm91cCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBodG1sRm9yOiAnZGVzY3JpcHRpb24nIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0Rlc2NyaXB0aW9uJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZm9ybS1jb250cm9sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ0Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5maWVsZENoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLmRlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdmb3JtLWdyb3VwJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGh0bWxGb3I6ICd0ZXh0JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUZXh0J1xuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdERyYWZ0V3lzaXd5Zy5FZGl0b3IsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JDbGFzc05hbWU6ICdmb3JtLWNvbnRyb2wnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2U6IHRoaXMub25FZGl0b3JTdGF0ZUNoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogWydpbmxpbmUnLCAnbGlzdCcsICdmb250U2l6ZScsICdmb250RmFtaWx5JywgJ3RleHRBbGlnbicsICdsaW5rJywgJ2hpc3RvcnknLCAnY29sb3JQaWNrZXInXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2NoZWNrYm94JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdwdWJsaWMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5maWVsZENoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkOiAhIXRoaXMuc3RhdGUucHVibGljXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyBQdWJsaWMnXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jb21wb25lbnQuQWxlcnRNZXNzYWdlLCB7IG9wdHM6IGFsZXJ0T3B0cyB9KSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ2hyJywgbnVsbCksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAnc3VibWl0JywgY2xhc3NOYW1lOiAnYnRuIGJ0bi1wcmltYXJ5JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLWZsb3BweS1kaXNrJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXFx4QTAgU2F2ZSdcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoJ2JyJywgbnVsbClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIEVkaXRDb21wO1xufShfcmVhY3QyLmRlZmF1bHQuQ29tcG9uZW50KTtcblxudmFyIG1hcFN0YXRlVG9Qcm9wcyA9IGZ1bmN0aW9uIG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSkge1xuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xufTtcbkVkaXRDb21wID0gKDAsIF9yZWFjdFJlZHV4LmNvbm5lY3QpKG1hcFN0YXRlVG9Qcm9wcykoRWRpdENvbXApO1xuZXhwb3J0cy5kZWZhdWx0ID0gRWRpdENvbXA7XG5cbi8qXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnXG5pbXBvcnQge2FwaSwgZ3JhcGhxbH0gZnJvbSAnLi4vaGVscGVycy9hY3Rpb24nXG5pbXBvcnQge0FsZXJ0TWVzc2FnZX0gZnJvbSAnLi4vaGVscGVycy9jb21wb25lbnQnXG5cbmltcG9ydCB7IEVkaXRvclN0YXRlLCBjb252ZXJ0VG9SYXcsIENvbnRlbnRTdGF0ZSB9IGZyb20gJ2RyYWZ0LWpzJztcbmltcG9ydCBkcmFmdFRvSHRtbCBmcm9tICdkcmFmdGpzLXRvLWh0bWwnO1xuaW1wb3J0IGh0bWxUb0RyYWZ0IGZyb20gJ2h0bWwtdG8tZHJhZnRqcyc7XG5pbXBvcnQgeyBFZGl0b3IgfSBmcm9tICdyZWFjdC1kcmFmdC13eXNpd3lnJztcblxuXG5cbmNsYXNzIEVkaXRDb21wIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7Li4ucHJvcHMuYmxvZ0VkaXR9O1xuICAgICAgICB0aGlzLnN0YXRlLmVkaXRvclN0YXRlID0gRWRpdG9yU3RhdGUuY3JlYXRlRW1wdHkoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsTW91bnQgKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdCTE9HX0dFVCcsXG4gICAgICAgICAgICBpZDogdGhpcy5zdGF0ZS5pZCxcbiAgICAgICAgfSkpO1xuXG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmIChuZXh0UHJvcHMuYmxvZ0VkaXQuc3RhdHVzID09ICdzdWNjZXNzX2dldCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2Nrc0Zyb21IVE1MID0gaHRtbFRvRHJhZnQobmV4dFByb3BzLmJsb2dFZGl0LnRleHQpO1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IENvbnRlbnRTdGF0ZS5jcmVhdGVGcm9tQmxvY2tBcnJheShcbiAgICAgICAgICAgICAgICBibG9ja3NGcm9tSFRNTC5jb250ZW50QmxvY2tzLFxuICAgICAgICAgICAgICAgIGJsb2Nrc0Zyb21IVE1MLmVudGl0eU1hcFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IG5leHRQcm9wcy5ibG9nRWRpdC50aXRsZSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBuZXh0UHJvcHMuYmxvZ0VkaXQudGV4dCxcbiAgICAgICAgICAgICAgICBwdWJsaWM6IG5leHRQcm9wcy5ibG9nRWRpdC5wdWJsaWMsXG4gICAgICAgICAgICAgICAgZGF0ZTogbmV4dFByb3BzLmJsb2dFZGl0LmRhdGUsXG4gICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLmNyZWF0ZVdpdGhDb250ZW50KGNvbnRlbnQpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG4gICAgZmllbGRDaGFuZ2UgKGUpIHtcbiAgICAgICAgbGV0IHN0YXRlT2JqID0ge307XG4gICAgICAgIGxldCB2YWwgPSAoZS50YXJnZXQuaWQgPT0gJ3B1YmxpYycpID8gZS50YXJnZXQuY2hlY2tlZCA6IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICBzdGF0ZU9ialtlLnRhcmdldC5pZF0gPSB2YWw7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGVPYmopO1xuICAgIH1cblxuICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2UgKGVkaXRvclN0YXRlKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZWRpdG9yU3RhdGVcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGZvcm1TdWJtaXQgKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBsZXQgdGV4dCA9IGRyYWZ0VG9IdG1sKGNvbnZlcnRUb1Jhdyh0aGlzLnN0YXRlLmVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkpKTtcblxuICAgICAgICBpZiAodGV4dCAmJiAodGV4dC5sZW5ndGggPiA1MTIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0JMT0dfRURJVF9FUlJPUicsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdUZXh0IGlzIHRvbyBsb25nIScsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICB0eXBlOiAnQkxPR19FRElUJyxcbiAgICAgICAgICAgIGlkOiB0aGlzLnN0YXRlLmlkLFxuICAgICAgICAgICAgdGl0bGU6IHRoaXMuc3RhdGUudGl0bGUsXG4gICAgICAgICAgICB0ZXh0OiBkcmFmdFRvSHRtbChjb252ZXJ0VG9SYXcodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKSksXG4gICAgICAgICAgICBwdWJsaWM6IHRoaXMuc3RhdGUucHVibGljLFxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgcmVuZGVyICgpIHtcbiAgICAgICAgbGV0IGFsZXJ0T3B0cyA9IG51bGw7XG4gICAgXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5wcm9wcy5ibG9nRWRpdC5lcnJvciB8fCAnRXJyb3IsIHdyb25nIGJsb2cgZGF0YSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ3NlbmQnKSB7XG4gICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnaW5mbycsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0xvYWRpbmcsIHBsZWFzZSB3YWl0JyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ3N1Y2Nlc3NfZWRpdCcpIHtcbiAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnQmxvZyBzYXZlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9ibG9nLWVkaXQvJyArIHRoaXMucHJvcHMuYmxvZ0VkaXQuaWQ7XG4gICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxkaXY+XG4gICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17Ojp0aGlzLmZvcm1TdWJtaXR9ID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0aXRsZVwiPlRpdGxlPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkPVwidGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiVGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXs6OnRoaXMuZmllbGRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50aXRsZX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0ZXh0XCI+VGV4dDwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxFZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlPXt0aGlzLnN0YXRlLmVkaXRvclN0YXRlfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yQ2xhc3NOYW1lPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2U9ezo6dGhpcy5vbkVkaXRvclN0YXRlQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhcj17e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFsnaW5saW5lJywgJ2xpc3QnLCAnZm9udFNpemUnLCAnZm9udEZhbWlseScsICd0ZXh0QWxpZ24nLCAnbGluaycsICdoaXN0b3J5JywgJ2NvbG9yUGlja2VyJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjaGVja2JveFwiPlxuICAgICAgICAgICAgICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cImNoZWNrYm94XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9J3B1YmxpYycgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9ezo6dGhpcy5maWVsZENoYW5nZX0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZCA9IHshISB0aGlzLnN0YXRlLnB1YmxpY31cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+IFB1YmxpY1xuICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPEFsZXJ0TWVzc2FnZSBvcHRzPXthbGVydE9wdHN9IC8+XG5cbiAgICAgICAgICAgICAgICA8aHIgLz5cbiAgICAgICAgICAgICAgICA8ZGl2ID5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgY2xhc3NOYW1lPVwiYnRuIGJ0bi1wcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J2dseXBoaWNvbiBnbHlwaGljb24tZmxvcHB5LWRpc2snPjwvc3Bhbj4mbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNhdmVcbiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICB9XG59XG5cbmNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IChzdGF0ZSkgPT4ge1xuICAgIHJldHVybiB7Li4uc3RhdGV9XG59XG5FZGl0Q29tcCA9IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzKShFZGl0Q29tcClcbmV4cG9ydCBkZWZhdWx0IEVkaXRDb21wXG4qL1xuXG4vKioqLyB9KSxcblxuLyoqKi8gNDE5OlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgICB2YWx1ZTogdHJ1ZVxufSk7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbi8qXG5cblwiaWRcIiBTRVJJQUwgUFJJTUFSWSBLRVksXG5cInVzZXJfaWRcIiBTRVJJQUwgTk9UIE5VTEwsXG5cImJsb2dfaWRcIiBTRVJJQUwgTk9UIE5VTEwsXG5cInRpdGxlXCIgdmFyY2hhcigxMjgpIERFRkFVTFQgTlVMTCxcblwiZGVzY3JpcHRpb25cIiB2YXJjaGFyKDI1NikgREVGQVVMVCBOVUxMLFxuXCJ0ZXh0XCIgdGV4dCxcblwiZGF0ZVwiIHRpbWVzdGFtcCBERUZBVUxUIE5VTExcblxuKi9cblxudmFyIGJsb2dJZCA9IHdpbmRvdy5sb2NhbFBhcmFtcy5ibG9nSWQ7XG52YXIgcG9zdElkID0gd2luZG93LmxvY2FsUGFyYW1zLnBvc3RJZCB8fCAnLTEnO1xudmFyIGluaXRTdGF0ZSA9IHtcbiAgICBpZDogcGFyc2VJbnQocG9zdElkKSxcbiAgICBibG9nSWQ6IHBhcnNlSW50KGJsb2dJZCksXG4gICAgdXNlcklkOiAwLFxuICAgIHVzZXJOYW1lOiAnJyxcbiAgICB1c2VyRW1haWw6ICcnLFxuICAgIHRpdGxlOiAnJyxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgdGV4dDogJycsXG4gICAgZGF0ZTogJycsXG4gICAgcHVibGljOiBmYWxzZSxcblxuICAgIC8vIHRlY2huaWNhbCBpbmZvXG4gICAgc3RhdHVzOiBudWxsXG59O1xuXG52YXIgcG9zdEVkaXQgPSBmdW5jdGlvbiBwb3N0RWRpdCgpIHtcbiAgICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGluaXRTdGF0ZTtcbiAgICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdO1xuXG4gICAgdmFyIGRhdGEgPSBudWxsO1xuXG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlICdNWV9QT1NUX0dFVF9TRU5EJzpcbiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcyh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnc2VuZCdcbiAgICAgICAgICAgIH0sIHN0YXRlKTtcblxuICAgICAgICBjYXNlICdNWV9QT1NUX0dFVF9TVUNDRVNTJzpcbiAgICAgICAgICAgIGRhdGEgPSBfZXh0ZW5kcyh7fSwgc3RhdGUpO1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnc3VjY2Vzc19nZXQnO1xuICAgICAgICAgICAgZGF0YS5pZCA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC5pZDtcbiAgICAgICAgICAgIGRhdGEuYmxvZ0lkID0gYWN0aW9uLmRhdGEuZ2V0TXlQb3N0LmJsb2dJZDtcbiAgICAgICAgICAgIGRhdGEudXNlcklkID0gYWN0aW9uLmRhdGEuZ2V0TXlQb3N0LnVzZXJJZDtcbiAgICAgICAgICAgIGRhdGEudXNlck5hbWUgPSBhY3Rpb24uZGF0YS5nZXRNeVBvc3QudXNlck5hbWU7XG4gICAgICAgICAgICBkYXRhLnVzZXJFbWFpbCA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC51c2VyRW1haWw7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gYWN0aW9uLmRhdGEuZ2V0TXlQb3N0LnRpdGxlO1xuICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbiA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIGRhdGEudGV4dCA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC50ZXh0O1xuICAgICAgICAgICAgZGF0YS5kYXRlID0gYWN0aW9uLmRhdGEuZ2V0TXlQb3N0LmRhdGU7XG4gICAgICAgICAgICBkYXRhLnB1YmxpYyA9ICEhYWN0aW9uLmRhdGEuZ2V0TXlQb3N0LnB1YmxpYztcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgICAgIGNhc2UgJ01ZX1BPU1RfR0VUX0VSUk9SJzpcbiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcyh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIGVycm9yOiBhY3Rpb24uZXJyb3JcbiAgICAgICAgICAgIH0sIHN0YXRlKTtcblxuICAgICAgICBjYXNlICdQT1NUX0VESVRfU0VORCc6XG4gICAgICAgICAgICBkYXRhID0gX2V4dGVuZHMoe30sIHN0YXRlKTtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3NlbmQnO1xuICAgICAgICAgICAgZGF0YS5pZCA9IGFjdGlvbi5pZDtcbiAgICAgICAgICAgIGRhdGEuYmxvZ0lkID0gYWN0aW9uLmJsb2dJZDtcbiAgICAgICAgICAgIGRhdGEudGl0bGUgPSBhY3Rpb24udGl0bGU7XG4gICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uID0gYWN0aW9uLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgZGF0YS50ZXh0ID0gYWN0aW9uLnRleHQ7XG4gICAgICAgICAgICBkYXRhLnB1YmxpYyA9IGFjdGlvbi5wdWJsaWM7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcblxuICAgICAgICBjYXNlICdQT1NUX0VESVRfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhID0gX2V4dGVuZHMoe30sIHN0YXRlKTtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3NfZWRpdCc7XG4gICAgICAgICAgICBkYXRhLmlkID0gYWN0aW9uLmRhdGEuZWRpdFBvc3QuaWQ7XG4gICAgICAgICAgICBkYXRhLmJsb2dJZCA9IGFjdGlvbi5kYXRhLmVkaXRQb3N0LmJsb2dJZDtcbiAgICAgICAgICAgIGRhdGEudGl0bGUgPSBhY3Rpb24uZGF0YS5lZGl0UG9zdC50aXRsZTtcbiAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24gPSBhY3Rpb24uZGF0YS5lZGl0UG9zdC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIGRhdGEudGV4dCA9IGFjdGlvbi5kYXRhLmVkaXRQb3N0LnRleHQ7XG4gICAgICAgICAgICBkYXRhLmRhdGUgPSBhY3Rpb24uZGF0YS5lZGl0UG9zdC5kYXRlO1xuICAgICAgICAgICAgZGF0YS5wdWJsaWMgPSBhY3Rpb24uZGF0YS5lZGl0UG9zdC5wdWJsaWM7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcblxuICAgICAgICBjYXNlICdQT1NUX0VESVRfRVJST1InOlxuICAgICAgICAgICAgZGF0YSA9IF9leHRlbmRzKHt9LCBzdGF0ZSk7XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICAgICAgICBkYXRhLmVycm9yID0gYWN0aW9uLmVycm9yO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG59O1xuXG5leHBvcnRzLmRlZmF1bHQgPSBwb3N0RWRpdDtcblxuLyoqKi8gfSlcblxufSxbNDE3XSk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHBvc3RFZGl0LmpzIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgcmVuZGVyIH0gZnJvbSAncmVhY3QtZG9tJ1xuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICdyZWFjdC1yZWR1eCdcblxuaW1wb3J0ICdib290c3RyYXAvZGlzdC9jc3MvYm9vdHN0cmFwLmNzcyc7XG5pbXBvcnQgJ3JlYWN0LWRyYWZ0LXd5c2l3eWcvZGlzdC9yZWFjdC1kcmFmdC13eXNpd3lnLmNzcyc7XG5pbXBvcnQgJy4vc3R5bGVzL2luZGV4LnNjc3MnXG5cbmltcG9ydCB7bGF5b3V0fSBmcm9tICcuL2hlbHBlcnMvY29tcG9uZW50J1xuaW1wb3J0IEVkaXRDb21wIGZyb20gJy4vcG9zdC9FZGl0Q29tcCdcblxuaW1wb3J0IGF1dGggZnJvbSAnLi9hdXRoL0xvZ2luUmVkJ1xuaW1wb3J0IHBvc3RFZGl0IGZyb20gJy4vcG9zdC9FZGl0UmVkJ1xuXG5pbXBvcnQge2NvbmZpZ3VyZVN0b3JlfSBmcm9tICcuL2hlbHBlcnMvY29uZmlndXJlU3RvcmUnXG5cblxubGV0IHN0b3JlID0gY29uZmlndXJlU3RvcmUoe1xuXHRhdXRoOiBhdXRoLFxuXHRwb3N0RWRpdDogcG9zdEVkaXQsXG59KTtcblxubGV0IENvbXAgPSBsYXlvdXQoe2NvbXA6IEVkaXRDb21wLCBmb3JBdXRoOiB0cnVlfSk7XG5yZW5kZXIoXG5cdDxQcm92aWRlciBzdG9yZT17c3RvcmV9PlxuXHRcdDxDb21wIC8+XG5cdDwvUHJvdmlkZXI+LFxuXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpXG4pXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zdGF0aWNfc3JjL3Bvc3RFZGl0LmpzIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlYWN0LXJlZHV4J1xuaW1wb3J0IHthcGksIGdyYXBocWx9IGZyb20gJy4uL2hlbHBlcnMvYWN0aW9uJ1xuaW1wb3J0IHtBbGVydE1lc3NhZ2V9IGZyb20gJy4uL2hlbHBlcnMvY29tcG9uZW50J1xuXG5pbXBvcnQgeyBFZGl0b3JTdGF0ZSwgY29udmVydFRvUmF3LCBDb250ZW50U3RhdGUgfSBmcm9tICdkcmFmdC1qcyc7XG5pbXBvcnQgZHJhZnRUb0h0bWwgZnJvbSAnZHJhZnRqcy10by1odG1sJztcbmltcG9ydCBodG1sVG9EcmFmdCBmcm9tICdodG1sLXRvLWRyYWZ0anMnO1xuaW1wb3J0IHsgRWRpdG9yIH0gZnJvbSAncmVhY3QtZHJhZnQtd3lzaXd5Zyc7XG5cbmNsYXNzIEVkaXRDb21wIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7Li4ucHJvcHMucG9zdEVkaXR9O1xuICAgICAgICB0aGlzLnN0YXRlLmVkaXRvclN0YXRlID0gRWRpdG9yU3RhdGUuY3JlYXRlRW1wdHkoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsTW91bnQgKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdNWV9QT1NUX0dFVCcsXG4gICAgICAgICAgICBpZDogdGhpcy5zdGF0ZS5pZCxcbiAgICAgICAgICAgIGJsb2dJZDogdGhpcy5zdGF0ZS5ibG9nSWRcbiAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmIChuZXh0UHJvcHMucG9zdEVkaXQuc3RhdHVzID09ICdzdWNjZXNzX2dldCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2Nrc0Zyb21IVE1MID0gaHRtbFRvRHJhZnQobmV4dFByb3BzLnBvc3RFZGl0LnRleHQpO1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IENvbnRlbnRTdGF0ZS5jcmVhdGVGcm9tQmxvY2tBcnJheShcbiAgICAgICAgICAgICAgICBibG9ja3NGcm9tSFRNTC5jb250ZW50QmxvY2tzLFxuICAgICAgICAgICAgICAgIGJsb2Nrc0Zyb21IVE1MLmVudGl0eU1hcFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBuZXh0UHJvcHMucG9zdEVkaXQudXNlcklkLFxuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBuZXh0UHJvcHMucG9zdEVkaXQudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgdXNlckVtYWlsOiBuZXh0UHJvcHMucG9zdEVkaXQudXNlckVtYWlsLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBuZXh0UHJvcHMucG9zdEVkaXQudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG5leHRQcm9wcy5wb3N0RWRpdC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICB0ZXh0OiBuZXh0UHJvcHMucG9zdEVkaXQudGV4dCxcbiAgICAgICAgICAgICAgICBkYXRlOiBuZXh0UHJvcHMucG9zdEVkaXQuZGF0ZSxcbiAgICAgICAgICAgICAgICBwdWJsaWM6IG5leHRQcm9wcy5wb3N0RWRpdC5wdWJsaWMsXG4gICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLmNyZWF0ZVdpdGhDb250ZW50KGNvbnRlbnQpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmaWVsZENoYW5nZSAoZSkge1xuICAgICAgICBsZXQgc3RhdGVPYmogPSB7fTtcbiAgICAgICAgbGV0IHZhbCA9IChlLnRhcmdldC5pZCA9PSAncHVibGljJykgPyBlLnRhcmdldC5jaGVja2VkIDogZS50YXJnZXQudmFsdWU7XG4gICAgICAgIHN0YXRlT2JqW2UudGFyZ2V0LmlkXSA9IHZhbDtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZU9iaik7XG4gICAgfVxuXG4gICAgb25FZGl0b3JTdGF0ZUNoYW5nZSAoZWRpdG9yU3RhdGUpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBlZGl0b3JTdGF0ZVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmb3JtU3VibWl0IChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IHRleHQgPSBkcmFmdFRvSHRtbChjb252ZXJ0VG9SYXcodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKSk7XG5cbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdQT1NUX0VESVQnLFxuICAgICAgICAgICAgaWQ6IHRoaXMuc3RhdGUuaWQsXG4gICAgICAgICAgICBibG9nSWQ6IHRoaXMuc3RhdGUuYmxvZ0lkLFxuICAgICAgICAgICAgdGl0bGU6IHRoaXMuc3RhdGUudGl0bGUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5zdGF0ZS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICBwdWJsaWM6IHRoaXMuc3RhdGUucHVibGljLFxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgcmVuZGVyICgpIHtcbiAgICAgICAgbGV0IGFsZXJ0T3B0cyA9IG51bGw7XG4gICAgXG4gICAgICAgIGlmICh0aGlzLnByb3BzLnBvc3RFZGl0LnN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5wcm9wcy5wb3N0RWRpdC5lcnJvciB8fCAnRXJyb3IsIHdyb25nIHBvc3QgZGF0YSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnBvc3RFZGl0LnN0YXR1cyA9PT0gJ3NlbmQnKSB7XG4gICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnaW5mbycsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0xvYWRpbmcsIHBsZWFzZSB3YWl0JyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnBvc3RFZGl0LnN0YXR1cyA9PT0gJ3N1Y2Nlc3NfZWRpdCcpIHtcbiAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnUG9zdCBzYXZlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gYC9wb3N0LWVkaXQvJHt0aGlzLnByb3BzLnBvc3RFZGl0LmJsb2dJZH0vJHt0aGlzLnByb3BzLnBvc3RFZGl0LmlkfWA7XG4gICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxkaXY+XG4gICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17Ojp0aGlzLmZvcm1TdWJtaXR9ID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0aXRsZVwiPlRpdGxlPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkPVwidGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiVGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXs6OnRoaXMuZmllbGRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50aXRsZX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJkZXNjcmlwdGlvblwiPkRlc2NyaXB0aW9uPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkPVwiZGVzY3JpcHRpb25cIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRGVzY3JpcHRpb25cIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXs6OnRoaXMuZmllbGRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5kZXNjcmlwdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0ZXh0XCI+VGV4dDwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxFZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlPXt0aGlzLnN0YXRlLmVkaXRvclN0YXRlfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yQ2xhc3NOYW1lPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2U9ezo6dGhpcy5vbkVkaXRvclN0YXRlQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhcj17e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFsnaW5saW5lJywgJ2xpc3QnLCAnZm9udFNpemUnLCAnZm9udEZhbWlseScsICd0ZXh0QWxpZ24nLCAnbGluaycsICdoaXN0b3J5JywgJ2NvbG9yUGlja2VyJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjaGVja2JveFwiPlxuICAgICAgICAgICAgICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cImNoZWNrYm94XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9J3B1YmxpYycgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9ezo6dGhpcy5maWVsZENoYW5nZX0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZCA9IHshISB0aGlzLnN0YXRlLnB1YmxpY31cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+IFB1YmxpY1xuICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPEFsZXJ0TWVzc2FnZSBvcHRzPXthbGVydE9wdHN9IC8+XG5cbiAgICAgICAgICAgICAgICA8aHIgLz5cbiAgICAgICAgICAgICAgICA8ZGl2ID5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgY2xhc3NOYW1lPVwiYnRuIGJ0bi1wcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J2dseXBoaWNvbiBnbHlwaGljb24tZmxvcHB5LWRpc2snPjwvc3Bhbj4mbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNhdmVcbiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIDwvZGl2PlxuICAgIH1cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG59XG5cbmNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IChzdGF0ZSkgPT4ge1xuICAgIHJldHVybiB7Li4uc3RhdGV9XG59XG5FZGl0Q29tcCA9IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzKShFZGl0Q29tcClcbmV4cG9ydCBkZWZhdWx0IEVkaXRDb21wXG5cblxuXG5cbi8qXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnXG5pbXBvcnQge2FwaSwgZ3JhcGhxbH0gZnJvbSAnLi4vaGVscGVycy9hY3Rpb24nXG5pbXBvcnQge0FsZXJ0TWVzc2FnZX0gZnJvbSAnLi4vaGVscGVycy9jb21wb25lbnQnXG5cbmltcG9ydCB7IEVkaXRvclN0YXRlLCBjb252ZXJ0VG9SYXcsIENvbnRlbnRTdGF0ZSB9IGZyb20gJ2RyYWZ0LWpzJztcbmltcG9ydCBkcmFmdFRvSHRtbCBmcm9tICdkcmFmdGpzLXRvLWh0bWwnO1xuaW1wb3J0IGh0bWxUb0RyYWZ0IGZyb20gJ2h0bWwtdG8tZHJhZnRqcyc7XG5pbXBvcnQgeyBFZGl0b3IgfSBmcm9tICdyZWFjdC1kcmFmdC13eXNpd3lnJztcblxuXG5cbmNsYXNzIEVkaXRDb21wIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7Li4ucHJvcHMuYmxvZ0VkaXR9O1xuICAgICAgICB0aGlzLnN0YXRlLmVkaXRvclN0YXRlID0gRWRpdG9yU3RhdGUuY3JlYXRlRW1wdHkoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsTW91bnQgKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChncmFwaHFsKHtcbiAgICAgICAgICAgIHR5cGU6ICdCTE9HX0dFVCcsXG4gICAgICAgICAgICBpZDogdGhpcy5zdGF0ZS5pZCxcbiAgICAgICAgfSkpO1xuXG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmIChuZXh0UHJvcHMuYmxvZ0VkaXQuc3RhdHVzID09ICdzdWNjZXNzX2dldCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2Nrc0Zyb21IVE1MID0gaHRtbFRvRHJhZnQobmV4dFByb3BzLmJsb2dFZGl0LnRleHQpO1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IENvbnRlbnRTdGF0ZS5jcmVhdGVGcm9tQmxvY2tBcnJheShcbiAgICAgICAgICAgICAgICBibG9ja3NGcm9tSFRNTC5jb250ZW50QmxvY2tzLFxuICAgICAgICAgICAgICAgIGJsb2Nrc0Zyb21IVE1MLmVudGl0eU1hcFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IG5leHRQcm9wcy5ibG9nRWRpdC50aXRsZSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBuZXh0UHJvcHMuYmxvZ0VkaXQudGV4dCxcbiAgICAgICAgICAgICAgICBwdWJsaWM6IG5leHRQcm9wcy5ibG9nRWRpdC5wdWJsaWMsXG4gICAgICAgICAgICAgICAgZGF0ZTogbmV4dFByb3BzLmJsb2dFZGl0LmRhdGUsXG4gICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLmNyZWF0ZVdpdGhDb250ZW50KGNvbnRlbnQpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG4gICAgZmllbGRDaGFuZ2UgKGUpIHtcbiAgICAgICAgbGV0IHN0YXRlT2JqID0ge307XG4gICAgICAgIGxldCB2YWwgPSAoZS50YXJnZXQuaWQgPT0gJ3B1YmxpYycpID8gZS50YXJnZXQuY2hlY2tlZCA6IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICBzdGF0ZU9ialtlLnRhcmdldC5pZF0gPSB2YWw7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGVPYmopO1xuICAgIH1cblxuICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2UgKGVkaXRvclN0YXRlKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZWRpdG9yU3RhdGVcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGZvcm1TdWJtaXQgKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBsZXQgdGV4dCA9IGRyYWZ0VG9IdG1sKGNvbnZlcnRUb1Jhdyh0aGlzLnN0YXRlLmVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkpKTtcblxuICAgICAgICBpZiAodGV4dCAmJiAodGV4dC5sZW5ndGggPiA1MTIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0JMT0dfRURJVF9FUlJPUicsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdUZXh0IGlzIHRvbyBsb25nIScsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goZ3JhcGhxbCh7XG4gICAgICAgICAgICB0eXBlOiAnQkxPR19FRElUJyxcbiAgICAgICAgICAgIGlkOiB0aGlzLnN0YXRlLmlkLFxuICAgICAgICAgICAgdGl0bGU6IHRoaXMuc3RhdGUudGl0bGUsXG4gICAgICAgICAgICB0ZXh0OiBkcmFmdFRvSHRtbChjb252ZXJ0VG9SYXcodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKSksXG4gICAgICAgICAgICBwdWJsaWM6IHRoaXMuc3RhdGUucHVibGljLFxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgcmVuZGVyICgpIHtcbiAgICAgICAgbGV0IGFsZXJ0T3B0cyA9IG51bGw7XG4gICAgXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgYWxlcnRPcHRzID0ge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5wcm9wcy5ibG9nRWRpdC5lcnJvciB8fCAnRXJyb3IsIHdyb25nIGJsb2cgZGF0YSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ3NlbmQnKSB7XG4gICAgICAgICAgICBhbGVydE9wdHMgPSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnaW5mbycsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0xvYWRpbmcsIHBsZWFzZSB3YWl0JyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLmJsb2dFZGl0LnN0YXR1cyA9PT0gJ3N1Y2Nlc3NfZWRpdCcpIHtcbiAgICAgICAgICAgIGFsZXJ0T3B0cyA9IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnQmxvZyBzYXZlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9ibG9nLWVkaXQvJyArIHRoaXMucHJvcHMuYmxvZ0VkaXQuaWQ7XG4gICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxkaXY+XG4gICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17Ojp0aGlzLmZvcm1TdWJtaXR9ID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0aXRsZVwiPlRpdGxlPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkPVwidGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiVGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXs6OnRoaXMuZmllbGRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50aXRsZX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0ZXh0XCI+VGV4dDwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxFZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlPXt0aGlzLnN0YXRlLmVkaXRvclN0YXRlfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yQ2xhc3NOYW1lPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdG9yU3RhdGVDaGFuZ2U9ezo6dGhpcy5vbkVkaXRvclN0YXRlQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhcj17e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFsnaW5saW5lJywgJ2xpc3QnLCAnZm9udFNpemUnLCAnZm9udEZhbWlseScsICd0ZXh0QWxpZ24nLCAnbGluaycsICdoaXN0b3J5JywgJ2NvbG9yUGlja2VyJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjaGVja2JveFwiPlxuICAgICAgICAgICAgICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cImNoZWNrYm94XCIgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9J3B1YmxpYycgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9ezo6dGhpcy5maWVsZENoYW5nZX0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZCA9IHshISB0aGlzLnN0YXRlLnB1YmxpY31cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+IFB1YmxpY1xuICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPEFsZXJ0TWVzc2FnZSBvcHRzPXthbGVydE9wdHN9IC8+XG5cbiAgICAgICAgICAgICAgICA8aHIgLz5cbiAgICAgICAgICAgICAgICA8ZGl2ID5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgY2xhc3NOYW1lPVwiYnRuIGJ0bi1wcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J2dseXBoaWNvbiBnbHlwaGljb24tZmxvcHB5LWRpc2snPjwvc3Bhbj4mbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNhdmVcbiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICB9XG59XG5cbmNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IChzdGF0ZSkgPT4ge1xuICAgIHJldHVybiB7Li4uc3RhdGV9XG59XG5FZGl0Q29tcCA9IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzKShFZGl0Q29tcClcbmV4cG9ydCBkZWZhdWx0IEVkaXRDb21wXG4qL1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3N0YXRpY19zcmMvcG9zdC9FZGl0Q29tcC5qcyIsIi8qXG5cblwiaWRcIiBTRVJJQUwgUFJJTUFSWSBLRVksXG5cInVzZXJfaWRcIiBTRVJJQUwgTk9UIE5VTEwsXG5cImJsb2dfaWRcIiBTRVJJQUwgTk9UIE5VTEwsXG5cInRpdGxlXCIgdmFyY2hhcigxMjgpIERFRkFVTFQgTlVMTCxcblwiZGVzY3JpcHRpb25cIiB2YXJjaGFyKDI1NikgREVGQVVMVCBOVUxMLFxuXCJ0ZXh0XCIgdGV4dCxcblwiZGF0ZVwiIHRpbWVzdGFtcCBERUZBVUxUIE5VTExcblxuKi9cblxubGV0IGJsb2dJZCA9IHdpbmRvdy5sb2NhbFBhcmFtcy5ibG9nSWQ7XG5sZXQgcG9zdElkID0gd2luZG93LmxvY2FsUGFyYW1zLnBvc3RJZCB8fCAnLTEnO1xubGV0IGluaXRTdGF0ZSA9IHtcbiAgICBpZDogcGFyc2VJbnQocG9zdElkKSxcbiAgICBibG9nSWQ6IHBhcnNlSW50KGJsb2dJZCksXG4gICAgdXNlcklkOiAwLFxuICAgIHVzZXJOYW1lOiAnJyxcbiAgICB1c2VyRW1haWw6ICcnLFxuICAgIHRpdGxlOiAnJyxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgdGV4dDogJycsXG4gICAgZGF0ZTogJycsXG4gICAgcHVibGljOiBmYWxzZSxcblxuICAgIC8vIHRlY2huaWNhbCBpbmZvXG4gICAgc3RhdHVzOiBudWxsLFxufTtcblxuXG5jb25zdCBwb3N0RWRpdCA9IChzdGF0ZSA9IGluaXRTdGF0ZSwgYWN0aW9uKSA9PiB7XG4gICAgbGV0IGRhdGEgPSBudWxsO1xuXG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlICdNWV9QT1NUX0dFVF9TRU5EJzpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnc2VuZCcsXG4gICAgICAgICAgICAgICAgLi4uc3RhdGVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgY2FzZSAnTVlfUE9TVF9HRVRfU1VDQ0VTUyc6XG4gICAgICAgICAgICBkYXRhID0gey4uLnN0YXRlfTtcbiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gJ3N1Y2Nlc3NfZ2V0JztcbiAgICAgICAgICAgIGRhdGEuaWQgPSBhY3Rpb24uZGF0YS5nZXRNeVBvc3QuaWQ7XG4gICAgICAgICAgICBkYXRhLmJsb2dJZCA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC5ibG9nSWQ7XG4gICAgICAgICAgICBkYXRhLnVzZXJJZCA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC51c2VySWQ7XG4gICAgICAgICAgICBkYXRhLnVzZXJOYW1lID0gYWN0aW9uLmRhdGEuZ2V0TXlQb3N0LnVzZXJOYW1lO1xuICAgICAgICAgICAgZGF0YS51c2VyRW1haWwgPSBhY3Rpb24uZGF0YS5nZXRNeVBvc3QudXNlckVtYWlsO1xuICAgICAgICAgICAgZGF0YS50aXRsZSA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC50aXRsZTtcbiAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24gPSBhY3Rpb24uZGF0YS5nZXRNeVBvc3QuZGVzY3JpcHRpb247XG4gICAgICAgICAgICBkYXRhLnRleHQgPSBhY3Rpb24uZGF0YS5nZXRNeVBvc3QudGV4dDtcbiAgICAgICAgICAgIGRhdGEuZGF0ZSA9IGFjdGlvbi5kYXRhLmdldE15UG9zdC5kYXRlO1xuICAgICAgICAgICAgZGF0YS5wdWJsaWMgPSAhISBhY3Rpb24uZGF0YS5nZXRNeVBvc3QucHVibGljO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgY2FzZSAnTVlfUE9TVF9HRVRfRVJST1InOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgZXJyb3I6IGFjdGlvbi5lcnJvcixcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgY2FzZSAnUE9TVF9FRElUX1NFTkQnOlxuICAgICAgICAgICAgZGF0YSA9IHsuLi5zdGF0ZX07XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzZW5kJztcbiAgICAgICAgICAgIGRhdGEuaWQgPSBhY3Rpb24uaWQ7XG4gICAgICAgICAgICBkYXRhLmJsb2dJZCA9IGFjdGlvbi5ibG9nSWQ7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gYWN0aW9uLnRpdGxlO1xuICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbiA9IGFjdGlvbi5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIGRhdGEudGV4dCA9IGFjdGlvbi50ZXh0O1xuICAgICAgICAgICAgZGF0YS5wdWJsaWMgPSBhY3Rpb24ucHVibGljO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgY2FzZSAnUE9TVF9FRElUX1NVQ0NFU1MnOlxuICAgICAgICAgICAgZGF0YSA9IHsuLi5zdGF0ZX07XG4gICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdzdWNjZXNzX2VkaXQnO1xuICAgICAgICAgICAgZGF0YS5pZCA9IGFjdGlvbi5kYXRhLmVkaXRQb3N0LmlkO1xuICAgICAgICAgICAgZGF0YS5ibG9nSWQgPSBhY3Rpb24uZGF0YS5lZGl0UG9zdC5ibG9nSWQ7XG4gICAgICAgICAgICBkYXRhLnRpdGxlID0gYWN0aW9uLmRhdGEuZWRpdFBvc3QudGl0bGU7XG4gICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uID0gYWN0aW9uLmRhdGEuZWRpdFBvc3QuZGVzY3JpcHRpb247XG4gICAgICAgICAgICBkYXRhLnRleHQgPSBhY3Rpb24uZGF0YS5lZGl0UG9zdC50ZXh0O1xuICAgICAgICAgICAgZGF0YS5kYXRlID0gYWN0aW9uLmRhdGEuZWRpdFBvc3QuZGF0ZTtcbiAgICAgICAgICAgIGRhdGEucHVibGljID0gYWN0aW9uLmRhdGEuZWRpdFBvc3QucHVibGljO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICBcbiAgICAgICAgY2FzZSAnUE9TVF9FRElUX0VSUk9SJzpcbiAgICAgICAgICAgIGRhdGEgPSB7Li4uc3RhdGV9O1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnZXJyb3InO1xuICAgICAgICAgICAgZGF0YS5lcnJvciA9IGFjdGlvbi5lcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuXG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgcG9zdEVkaXQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3RhdGljX3NyYy9wb3N0L0VkaXRSZWQuanMiXSwic291cmNlUm9vdCI6IiJ9